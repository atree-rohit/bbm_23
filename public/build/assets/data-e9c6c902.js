import{g as v,m as b,_ as g,r as f,c as i,j as k,o as l,q as B,s as y,b as s,F as p,i as _,h as D,t as n,n as M,p as S,k as $,f as j}from"./_plugin-vue_export-helper-6122d275.js";import{M as q,d as O,s as U}from"./MapComponent-16990228.js";const x=v({name:"MapBBMData",components:{MapComponent:q},emits:["polygon-clicked"],data(){return{geojson:{district:O,state:U},mode:"state"}},computed:{...b({district_coordinators:t=>t.district_coordinators.all_data,map_data:t=>t.data.map_data})},mounted(){console.log("MapBBMData mounted")},watch:{map_data(t){console.log("mapData changed"),console.log(t)}},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},polygonClick(t){this.$emit("polygon-clicked",t)}}}),I={class:"map-container border border-danger rounded"};function L(t,o,e,r,c,C){const u=f("map-component");return l(),i("div",I,[k(u,{geojson:t.geojson[t.mode],data:t.map_data,modes:["state","district"],tooltip_third_row_label:"Observations",onModeChange:o[0]||(o[0]=a=>t.mode=a),onPolygonClicked:t.polygonClick},null,8,["geojson","data","onPolygonClicked"])])}const P=g(x,[["render",L]]);const F=v({name:"DataComponent",components:{MapBBMData:P},data(){return{filters:[{id:1,name:"Portals",active:!1},{id:2,name:"Location",active:!1},{id:3,name:"Taxa",active:!1},{id:4,name:"Date",active:!1},{id:5,name:"Users",active:!0}]}},computed:{...b({loading:t=>t.data.loading,observations:t=>t.data.observations,taxa:t=>t.data.taxa}),observation_stats(){return Object.keys(this.observations).length===0?(console.log("no observations"),{}):{counts:this.observationStats(this.observations.counts),inat:this.observationStats(this.observations.inats),ibp:this.observationStats(this.observations.ibps),ifb:this.observationStats(this.observations.ifbs),total:this.observationStats([].concat(...Object.values(this.observations)))}},observation_table_stats(){let t=[];for(let[o,e]of Object.entries(this.observation_stats))t.push({portal:o,observations:e.observations,users:e.users,states:e.states,districts:e.districts});return t},taxa_stats(){const t=Object.values(this.observations).flat();return B(this.taxa,e=>e.rank).map(e=>({rank:e[0],count:t.filter(r=>e[1].map(c=>c.id).includes(r[1])).length,unique:this.countUnique(e[1].map(r=>r.name))})).filter(e=>e.count>0)}},mounted(){y.dispatch("data/getAllData")},methods:{observationStats(t){return{observations:t.length,users:this.countUnique(t.map(e=>e[2])),states:this.countUnique(t.map(e=>e[4])),districts:this.countUnique(t.map(e=>e[5]))}},getObservationsCount(t){let o=0;return t.map(e=>{Object.keys(this.observations).forEach(r=>{o+=this.observations[r].filter(c=>c[1]==e.id).length})}),o},countUnique(t){return[...new Set(t)].length}}}),h=t=>(S("data-v-1e389c49"),t=t(),$(),t),N={class:"data-container"},V={class:"filters"},A=h(()=>s("div",{class:"expand-btn"}," >> ",-1)),E={class:"filter-list"},T=["onClick"],z={class:"header"},R={class:"canvas"},G={class:"observations"},H={class:"table table-sm"},J=h(()=>s("thead",{class:"bg-info"},[s("tr",null,[s("th",{scope:"col"},"Portal"),s("th",{scope:"col"},"Observations"),s("th",{scope:"col"},"Users"),s("th",{scope:"col"},"States"),s("th",{scope:"col"},"Districts")])],-1)),K={class:"table-info"},Q={class:"table table-sm"},W=h(()=>s("thead",{class:"bg-danger text-light"},[s("tr",null,[s("th",null,"Rank"),s("th",null,"Count"),s("th",null,"Unique")])],-1)),X={class:"table-danger"},Y={class:"taxa"};function Z(t,o,e,r,c,C){const u=f("MapBBMData");return l(),i(p,null,[s("div",N,[s("div",V,[A,s("ul",E,[(l(!0),i(p,null,_(t.filters,a=>(l(),i("li",{key:a.id,class:M({active:a.active}),onClick:d=>a.active=!a.active},[s("div",z,n(a.name),1)],10,T))),128))])]),s("div",R,[s("div",G,[s("table",H,[J,s("tbody",K,[(l(!0),i(p,null,_(t.observation_table_stats,(a,d)=>(l(),i("tr",{key:d},[s("td",null,n(a.portal),1),s("td",null,n(a.observations),1),s("td",null,n(a.users),1),s("td",null,n(a.states),1),s("td",null,n(a.districts),1)]))),128))])]),s("table",Q,[W,s("tbody",X,[(l(!0),i(p,null,_(t.taxa_stats,(a,d)=>(l(),i("tr",{key:d},[s("td",null,n(a.rank),1),s("td",null,n(a.count),1),s("td",null,n(a.unique),1)]))),128))])])]),s("div",Y,[k(u)])])]),D(" "+n(t.loading),1)],64)}const w=g(F,[["render",Z],["__scopeId","data-v-1e389c49"]]),m=j({});m.component("DataComponent",w);m.use(y);m.mount("#app");

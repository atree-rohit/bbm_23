import{m as v,_ as b,c as i,b as s,t as n,d as C,o as l,g as y,r as h,h as D,j as m,F as _,x as S,s as k,i as p,n as B,p as M,k as j,f as O}from"./_plugin-vue_export-helper-965d97d6.js";import{M as q,d as x,s as U}from"./MapComponent-a924964f.js";const L={name:"LoadingData",computed:{...v({loading:t=>t.data.loading})}},N={key:0,class:"loading-container"},I=s("div",{class:"circle"},null,-1),P=s("div",{class:"circle"},null,-1),V=s("div",{class:"circle"},null,-1),F=s("div",{class:"circle"},null,-1),A={class:"text"};function E(t,o,e,c,r,$){return t.loading?(l(),i("div",N,[I,P,V,F,s("div",A,n(t.loading),1)])):C("",!0)}const J=b(L,[["render",E]]);const T=y({name:"MapBBMData",components:{MapComponent:q,LoadingData:J},data(){return{geojson:{district:x,state:U},mode:"state",selected:{state:null,district:null}}},computed:{...v({district_coordinators:t=>t.district_coordinators.all_data,map_data:t=>t.data.map_data}),filtered_map_data(){let t=JSON.parse(JSON.stringify(this.map_data));return this.selected.state!=null&&(t.state=t.state.filter(o=>o.name===this.selected.state)),this.selected.district!=null&&(t.district=t.district.filter(o=>o.name===this.selected.district)),t}},mounted(){},watch:{map_data(t){console.log("mapData changed",t)}},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},polygonClick(t){this.selected[t.mode]=this.selected[t.mode]===t.name?null:t.name,this.selected[t.mode==="state"?"district":"state"]=null}}}),z={class:"map-container border border-danger rounded"};function R(t,o,e,c,r,$){const u=h("loading-data"),a=h("map-component");return l(),i(_,null,[D(n(t.selected)+" ",1),s("div",z,[m(u),m(a,{geojson:t.geojson[t.mode],data:t.filtered_map_data,modes:["state","district"],tooltip_third_row_label:"Observations",onModeChange:o[0]||(o[0]=d=>t.mode=d),onPolygonClicked:t.polygonClick},null,8,["geojson","data","onPolygonClicked"])])],64)}const G=b(T,[["render",R]]);const H=y({name:"DataComponent",components:{MapBBMData:G},data(){return{filters:[{id:1,name:"Portals",active:!1},{id:2,name:"Location",active:!1},{id:3,name:"Taxa",active:!1},{id:4,name:"Date",active:!1},{id:5,name:"Users",active:!0}]}},computed:{...v({observations:t=>t.data.observations,taxa:t=>t.data.taxa}),observation_stats(){return Object.keys(this.observations).length===0?(console.log("no observations"),{}):{counts:this.observationStats(this.observations.counts),inat:this.observationStats(this.observations.inats),ibp:this.observationStats(this.observations.ibps),ifb:this.observationStats(this.observations.ifbs),total:this.observationStats([].concat(...Object.values(this.observations)))}},observation_table_stats(){let t=[];for(let[o,e]of Object.entries(this.observation_stats))t.push({portal:o,observations:e.observations,users:e.users,states:e.states,districts:e.districts});return t},taxa_stats(){const t=Object.values(this.observations).flat();return S(this.taxa,e=>e.rank).map(e=>({rank:e[0],count:t.filter(c=>e[1].map(r=>r.id).includes(c[1])).length,unique:this.countUnique(e[1].map(c=>c.name))})).filter(e=>e.count>0)}},mounted(){k.dispatch("data/getAllData")},methods:{observationStats(t){return{observations:t.length,users:this.countUnique(t.map(e=>e[2])),states:this.countUnique(t.map(e=>e[4])),districts:this.countUnique(t.map(e=>e[5]))}},getObservationsCount(t){let o=0;return t.map(e=>{Object.keys(this.observations).forEach(c=>{o+=this.observations[c].filter(r=>r[1]==e.id).length})}),o},countUnique(t){return[...new Set(t)].length}}}),g=t=>(M("data-v-3db338f9"),t=t(),j(),t),K={class:"data-container"},Q={class:"filters"},W=g(()=>s("div",{class:"expand-btn"}," >> ",-1)),X={class:"filter-list"},Y=["onClick"],Z={class:"header"},w={class:"canvas"},tt={class:"observations"},st={class:"table table-sm"},et=g(()=>s("thead",{class:"bg-info"},[s("tr",null,[s("th",{scope:"col"},"Portal"),s("th",{scope:"col"},"Observations"),s("th",{scope:"col"},"Users"),s("th",{scope:"col"},"States"),s("th",{scope:"col"},"Districts")])],-1)),at={class:"table-info"},ot={class:"table table-sm"},nt=g(()=>s("thead",{class:"bg-danger text-light"},[s("tr",null,[s("th",null,"Rank"),s("th",null,"Count"),s("th",null,"Unique")])],-1)),it={class:"table-danger"},lt={class:"taxa"};function ct(t,o,e,c,r,$){const u=h("MapBBMData");return l(),i("div",K,[s("div",Q,[W,s("ul",X,[(l(!0),i(_,null,p(t.filters,a=>(l(),i("li",{key:a.id,class:B({active:a.active}),onClick:d=>a.active=!a.active},[s("div",Z,n(a.name),1)],10,Y))),128))])]),s("div",w,[s("div",tt,[s("table",st,[et,s("tbody",at,[(l(!0),i(_,null,p(t.observation_table_stats,(a,d)=>(l(),i("tr",{key:d},[s("td",null,n(a.portal),1),s("td",null,n(a.observations),1),s("td",null,n(a.users),1),s("td",null,n(a.states),1),s("td",null,n(a.districts),1)]))),128))])]),s("table",ot,[nt,s("tbody",it,[(l(!0),i(_,null,p(t.taxa_stats,(a,d)=>(l(),i("tr",{key:d},[s("td",null,n(a.rank),1),s("td",null,n(a.count),1),s("td",null,n(a.unique),1)]))),128))])])]),s("div",lt,[m(u)])])])}const rt=b(H,[["render",ct],["__scopeId","data-v-3db338f9"]]),f=O({});f.component("DataComponent",rt);f.use(k);f.mount("#app");

import{m as b,_ as g,c as i,b as s,t as n,d as M,o as c,p as y,k as C,g as D,r as m,j as v,x as S,s as B,F as _,i as h,h as j,n as q,f as x}from"./_plugin-vue_export-helper-5f9bfec6.js";import{M as L,d as O,s as U}from"./MapComponent-092acc64.js";const I={name:"LoadingData",mounted(){console.log("LoadingData mounted")},computed:{...b({loading:t=>t.data.loading})}},p=t=>(y("data-v-94cde733"),t=t(),C(),t),N={key:0,class:"loading-container"},P=p(()=>s("div",{class:"circle"},null,-1)),V=p(()=>s("div",{class:"circle"},null,-1)),F=p(()=>s("div",{class:"circle"},null,-1)),A=p(()=>s("div",{class:"circle"},null,-1)),E={class:"text"};function T(t,o,e,l,d,k){return t.loading?(c(),i("div",N,[P,V,F,A,s("div",E,n(t.loading),1)])):M("",!0)}const z=g(I,[["render",T],["__scopeId","data-v-94cde733"]]);const R=D({name:"MapBBMData",components:{MapComponent:L,LoadingData:z},emits:["polygon-clicked"],data(){return{geojson:{district:O,state:U},mode:"state"}},computed:{...b({district_coordinators:t=>t.district_coordinators.all_data,map_data:t=>t.data.map_data})},mounted(){console.log("MapBBMData mounted")},watch:{map_data(t){console.log("mapData changed"),console.log(t)}},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},polygonClick(t){this.$emit("polygon-clicked",t)}}}),w={class:"map-container border border-danger rounded"};function G(t,o,e,l,d,k){const u=m("loading-data"),a=m("map-component");return c(),i("div",w,[v(u),v(a,{geojson:t.geojson[t.mode],data:t.map_data,modes:["state","district"],tooltip_third_row_label:"Observations",onModeChange:o[0]||(o[0]=r=>t.mode=r),onPolygonClicked:t.polygonClick},null,8,["geojson","data","onPolygonClicked"])])}const H=g(R,[["render",G]]);const J=D({name:"DataComponent",components:{MapBBMData:H},data(){return{filters:[{id:1,name:"Portals",active:!1},{id:2,name:"Location",active:!1},{id:3,name:"Taxa",active:!1},{id:4,name:"Date",active:!1},{id:5,name:"Users",active:!0}]}},computed:{...b({loading:t=>t.data.loading,observations:t=>t.data.observations,taxa:t=>t.data.taxa}),observation_stats(){return Object.keys(this.observations).length===0?(console.log("no observations"),{}):{counts:this.observationStats(this.observations.counts),inat:this.observationStats(this.observations.inats),ibp:this.observationStats(this.observations.ibps),ifb:this.observationStats(this.observations.ifbs),total:this.observationStats([].concat(...Object.values(this.observations)))}},observation_table_stats(){let t=[];for(let[o,e]of Object.entries(this.observation_stats))t.push({portal:o,observations:e.observations,users:e.users,states:e.states,districts:e.districts});return t},taxa_stats(){const t=Object.values(this.observations).flat();return S(this.taxa,e=>e.rank).map(e=>({rank:e[0],count:t.filter(l=>e[1].map(d=>d.id).includes(l[1])).length,unique:this.countUnique(e[1].map(l=>l.name))})).filter(e=>e.count>0)}},mounted(){B.dispatch("data/getAllData")},methods:{observationStats(t){return{observations:t.length,users:this.countUnique(t.map(e=>e[2])),states:this.countUnique(t.map(e=>e[4])),districts:this.countUnique(t.map(e=>e[5]))}},getObservationsCount(t){let o=0;return t.map(e=>{Object.keys(this.observations).forEach(l=>{o+=this.observations[l].filter(d=>d[1]==e.id).length})}),o},countUnique(t){return[...new Set(t)].length}}}),f=t=>(y("data-v-1e389c49"),t=t(),C(),t),K={class:"data-container"},Q={class:"filters"},W=f(()=>s("div",{class:"expand-btn"}," >> ",-1)),X={class:"filter-list"},Y=["onClick"],Z={class:"header"},tt={class:"canvas"},st={class:"observations"},et={class:"table table-sm"},at=f(()=>s("thead",{class:"bg-info"},[s("tr",null,[s("th",{scope:"col"},"Portal"),s("th",{scope:"col"},"Observations"),s("th",{scope:"col"},"Users"),s("th",{scope:"col"},"States"),s("th",{scope:"col"},"Districts")])],-1)),ot={class:"table-info"},nt={class:"table table-sm"},it=f(()=>s("thead",{class:"bg-danger text-light"},[s("tr",null,[s("th",null,"Rank"),s("th",null,"Count"),s("th",null,"Unique")])],-1)),ct={class:"table-danger"},lt={class:"taxa"};function dt(t,o,e,l,d,k){const u=m("MapBBMData");return c(),i(_,null,[s("div",K,[s("div",Q,[W,s("ul",X,[(c(!0),i(_,null,h(t.filters,a=>(c(),i("li",{key:a.id,class:q({active:a.active}),onClick:r=>a.active=!a.active},[s("div",Z,n(a.name),1)],10,Y))),128))])]),s("div",tt,[s("div",st,[s("table",et,[at,s("tbody",ot,[(c(!0),i(_,null,h(t.observation_table_stats,(a,r)=>(c(),i("tr",{key:r},[s("td",null,n(a.portal),1),s("td",null,n(a.observations),1),s("td",null,n(a.users),1),s("td",null,n(a.states),1),s("td",null,n(a.districts),1)]))),128))])]),s("table",nt,[it,s("tbody",ct,[(c(!0),i(_,null,h(t.taxa_stats,(a,r)=>(c(),i("tr",{key:r},[s("td",null,n(a.rank),1),s("td",null,n(a.count),1),s("td",null,n(a.unique),1)]))),128))])])]),s("div",lt,[v(u)])])]),j(" "+n(t.loading),1)],64)}const rt=g(J,[["render",dt],["__scopeId","data-v-1e389c49"]]),$=x({});$.component("DataComponent",rt);$.use(B);$.mount("#app");

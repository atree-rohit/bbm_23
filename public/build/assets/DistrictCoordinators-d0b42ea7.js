import{g as v,m as $,e as V,_ as y,r as b,c as l,b as s,F as h,i as f,d as u,o as a,t as m,w as C,v as F,q as j,l as I,p as k,k as D,y as N,n as A,j as w,s as z,u as P}from"./_plugin-vue_export-helper-b0ae1e6c.js";import{F as U}from"./FileUploadComponent-2813424f.js";import{s as M,z as E,m as x,i as B,a as g,b as O,l as q,c as T,f as W}from"./indexRollupNext-cfd1a63d.js";import{d as L}from"./districts-fe2f3589.js";const X=v({name:"ModalAddPartner",props:{show:{type:Boolean,default:!1}},components:{FileUploadComponent:U},emits:["close"],data(){return{form_questions:[{type:"text",label:"Name",name:"name",required:!0},{type:"text",label:"Organization / Designation",name:"designation",required:!1},{type:"select",label:"State",name:"state",required:!0,options:[]},{type:"select",label:"District",name:"district",required:!0,options:[]},{type:"text",label:"Coordinates (Latitude, Longitude)",name:"coordinates",required:!1},{type:"text",label:"Email",name:"email",required:!1},{type:"text",label:"Phone Number",name:"phone",required:!1},{type:"file",label:"Image",name:"image",required:!1}],form_data:{},upload_file_flag:!1}},created(){this.initSelectOptions(),this.initFormData()},watch:{show(t){let e=document.querySelector("body");t==!0?e.classList.add("modal-open"):e.classList.remove("modal-open")}},computed:{...$({user:t=>t.auth.user}),select_district_options(){let t=[];if(this.form_data.state=="-1")t.push({label:"Select State First",value:"-1"});else{t.push({label:"Select District",value:"-1"});let e=[];L.features.map(o=>{this.valueFromLabel(o.properties.state)==this.form_data.state&&e.push({label:o.properties.district.trim(),value:this.valueFromLabel(o.properties.district.trim())})}),t=t.concat(e.sort((o,r)=>o.label<r.label?-1:o.label>r.label?1:0))}return t}},methods:{...V({store:"district_coordinators/store"}),initSelectOptions(){this.form_questions[2].options=M.features.map(t=>({label:t.properties.state.trim(),value:this.valueFromLabel(t.properties.state.trim())})).sort((t,e)=>t.label<e.label?-1:t.label>e.label?1:0)},initFormData(){this.form_data={name:"",designation:"",district:"-1",state:"-1",coordinates:"",email:"",phone:"",image:"",user:this.user}},valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},closeModal(){this.$emit("close")},handleUploadedFileId(t){this.form_data.image=t.data.id;try{this.store(this.form_data),this.initFormData(),this.closeModal(),this.upload_file_flag=!1}catch(e){console.error(e)}},submit(){this.upload_file_flag=!0}}}),Y=t=>(k("data-v-774a9898"),t=t(),D(),t),H={key:0,class:"modal fade show","aria-modal":"true",role:"dialog"},Z={class:"modal-dialog modal-lg"},J={class:"modal-content"},R={class:"modal-header"},G=Y(()=>s("h3",{class:"modal-title",id:"exampleModalLiveLabel"},"Add District Coordinator",-1)),K={class:"modal-body"},Q=["for","textContent"],tt=["onUpdate:modelValue","placeholder"],et=["onUpdate:modelValue","placeholder"],ot=["onUpdate:modelValue"],st={selected:"true",value:"-1"},at=["value","textContent"],it=["onUpdate:modelValue"],lt=["value","textContent"],rt={class:"modal-footer"},nt={key:1,class:"modal-backdrop fade show"};function dt(t,e,o,r,c,_){const n=b("file-upload-component");return a(),l(h,null,[t.show?(a(),l("div",H,[s("div",Z,[s("div",J,[s("div",R,[G,s("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...i)=>t.closeModal&&t.closeModal(...i))})]),s("div",K,[s("form",{action:"javascript:void(0)",onSubmit:e[1]||(e[1]=(...i)=>t.submit&&t.submit(...i)),class:"row",method:"post"},[(a(!0),l(h,null,f(t.form_questions,i=>(a(),l("div",{key:i.name,class:"form-group col-12"},[s("label",{for:i.name,class:"font-weight-bold",textContent:m(i.label)},null,8,Q),i.type=="text"?C((a(),l("input",{key:0,type:"text","onUpdate:modelValue":d=>t.form_data[i.name]=d,placeholder:`Enter ${i.name}`,class:"form-control"},null,8,tt)),[[F,t.form_data[i.name]]]):i.type=="textarea"?C((a(),l("textarea",{key:1,"onUpdate:modelValue":d=>t.form_data[i.name]=d,placeholder:`Enter ${i.name}`,class:"form-control"},null,8,et)),[[F,t.form_data[i.name]]]):i.name=="state"?C((a(),l("select",{key:2,"onUpdate:modelValue":d=>t.form_data[i.name]=d,class:"form-select"},[s("option",st,"Select "+m(i.label),1),(a(!0),l(h,null,f(i.options,d=>(a(),l("option",{key:d.value,value:d.value,textContent:m(d.label)},null,8,at))),128))],8,ot)),[[j,t.form_data[i.name]]]):i.name=="district"?C((a(),l("select",{key:3,"onUpdate:modelValue":d=>t.form_data[i.name]=d,class:"form-select"},[(a(!0),l(h,null,f(t.select_district_options,d=>(a(),l("option",{key:d.value,value:d.value,textContent:m(d.label)},null,8,lt))),128))],8,it)),[[j,t.form_data[i.name]]]):i.type=="file"?(a(),I(n,{key:4,class:"form-control",type:"file",upload_file:t.upload_file_flag,folder:"district_coordinators",onUploaded_file_id:t.handleUploadedFileId},null,8,["upload_file","onUploaded_file_id"])):u("",!0)]))),128))],32)]),s("div",rt,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[2]||(e[2]=(...i)=>t.closeModal&&t.closeModal(...i))},"Close"),s("button",{type:"button",class:"btn btn-success",onClick:e[3]||(e[3]=(...i)=>t.submit&&t.submit(...i))},"Save changes")])])])])):u("",!0),t.show?(a(),l("div",nt)):u("",!0)],64)}const ct=y(X,[["render",dt],["__scopeId","data-v-774a9898"]]);const pt=v({name:"ModalViewDistrictCoordinators",props:{show:{type:Boolean,default:!1},data:{type:Array,default:()=>[]}},emits:["close"],data(){return{form_questions:[{type:"text",label:"Name",name:"name",required:!0},{type:"text",label:"Organization / Designation",name:"designation",required:!1},{type:"select",label:"State",name:"state",required:!0,options:[]},{type:"select",label:"District",name:"district",required:!0,options:[]},{type:"text",label:"Coordinates (Latitude, Longitude)",name:"coordinates",required:!1},{type:"text",label:"Email",name:"email",required:!1},{type:"text",label:"Phone Number",name:"phone",required:!1},{type:"file",label:"Image",name:"image",required:!1}],current_district_coordinator_id:0}},created(){},watch:{show(t){let e=document.querySelector("body");t==!0?e.classList.add("modal-open"):e.classList.remove("modal-open")}},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},closeModal(){this.$emit("close")}}}),mt=t=>(k("data-v-8a06ddf1"),t=t(),D(),t),ut={key:0,class:"modal fade show","aria-modal":"true",role:"dialog"},ht={class:"modal-dialog modal-lg"},_t={class:"modal-content"},ft={class:"modal-header"},gt=mt(()=>s("h3",{class:"modal-title",id:"exampleModalLiveLabel"},"View District Coordinator",-1)),bt={class:"modal-body"},vt={key:0,class:"btn-group mx-auto d-flex justify-content-center"},yt={class:"my-0 mx-5 h3"},Ct={class:"table"},wt={class:"modal-footer"},$t={key:1,class:"modal-backdrop fade show"};function kt(t,e,o,r,c,_){return a(),l(h,null,[t.show?(a(),l("div",ut,[s("div",ht,[s("div",_t,[s("div",ft,[gt,s("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...n)=>t.closeModal&&t.closeModal(...n))})]),s("div",bt,[t.data.length>=1?(a(),l("div",vt,[s("div",null,[t.current_district_coordinator_id>0?(a(),l("button",{key:0,class:"btn btn-outline-secondary",onClick:e[1]||(e[1]=n=>t.current_district_coordinator_id--)}," < ")):u("",!0)]),s("div",yt,m(t.current_district_coordinator_id),1),s("div",null,[t.current_district_coordinator_id<t.data.length-1?(a(),l("button",{key:0,class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=n=>t.current_district_coordinator_id++)}," > ")):u("",!0)])])):u("",!0),s("table",Ct,[s("tbody",null,[(a(!0),l(h,null,f(t.form_questions,n=>(a(),l("tr",{key:n.name},[s("td",null,m(n.label),1),s("td",null,m(t.data[t.current_district_coordinator_id][n.name]),1)]))),128))])])]),s("div",wt,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[3]||(e[3]=(...n)=>t.closeModal&&t.closeModal(...n))},"Close"),s("button",{type:"button",class:"btn btn-success",onClick:e[4]||(e[4]=(...n)=>t.submit&&t.submit(...n))},"Save changes")])])])])):u("",!0),t.show?(a(),l("div",$t)):u("",!0)],64)}const Dt=y(pt,[["render",kt],["__scopeId","data-v-8a06ddf1"]]);const Mt=v({name:"MapComponent",props:{geojson:{type:Object,required:!0},data:{type:Object,required:!0},modes:{type:Array,required:!0},tooltip_third_row_label:{type:String,default:""}},emits:["mode-change","polygon-clicked"],data(){return{mode:this.modes[0],polygons:null,path:null,svg:null,projection:null,colors:null,max:null,height:500,width:500,zoomTransform:0,tooltip:null}},watch:{mode(t){this.$emit("mode-change",t)},data(t){console.log("data changed"),this.init()}},computed:{mapData(){return this.data[this.mode]},zoom(){return E().scaleExtent([.5,250]).translateExtent([[-.5*this.width,-.75*this.height],[2.5*this.width,2.5*this.height]]).on("zoom",this.handleZoom)}},mounted(){console.log("mounted: initializing"),this.geojson&&this.init()},updated(){console.log("updated: re-initializing"),this.init()},methods:{init(){console.log("init"),this.geojson.features?(this.init_variables(),this.init_legend(),this.init_svg(),this.render_map()):console.log("No geojson")},init_variables(){this.polygons=null,this.path=null,this.svg={},this.height=window.innerHeight*.8,this.width=window.innerWidth*.65,window.innerWidth<800?this.projection=x().scale(600).center([110,20]):this.projection=x().scale(1e3).center([80,27.5]),this.path=B().projection(this.projection),this.tooltip=this.init_tooltip()},init_tooltip(){return g("body .d3-tooltip").empty()||g("body .d3-tooltip").remove(),g("body").append("div").attr("class","d3-tooltip").style("position","absolute").style("top","0").style("z-index","10").style("visibility","hidden").style("padding","10px").style("background","rgba(0,0,0,0.75)").style("border-radius","4px").style("color","#fff").text("a simple tooltip")},init_legend(){this.colors={},this.legend={},this.max=O(this.mapData,t=>t.value),this.colors=q().domain([0,1,this.max/3,this.max]).range(["#c33","#488","#fd0","#24ff00"]).clamp(!0),this.legend=T().shapeHeight(20).shapeWidth(60).scale(this.colors).labelFormat(W(",.0f")).orient("horizontal").labelOffset(-10).labelAlign("middle").cells(6)},init_svg(){g("#map-container svg.svg-content").empty()||g("#map-container svg.svg-content").remove(),this.svg=g("#map-container").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",this.width).attr("height",this.height).classed("svg-content",!0),this.zoomTransform||(this.zoomTransform=N(this.svg.node())),this.height>this.width&&this.legend.shapeWidth(35).cells(4)},render_map(){let t=this.svg.append("g").classed("map-boundary",!0).selectAll("path").append("g");this.svg.append("g").classed("map-labels",!0).selectAll("text").append("g"),this.polygons=t.append("g").classed("polygons",!0),this.geojson.features.forEach(e=>{this.drawPolygon(e)}),this.svg.append("g").attr("class","legend").attr("transform","translate("+this.width*.55+", 25)").call(this.legend),this.svg.call(this.zoom),this.svg.call(this.zoom.transform,this.zoomTransform)},drawPolygon(t){this.polygons.append("g").data([t]).enter().append("path").attr("d",this.path).attr("id",this.getPolygonId(t.properties)).attr("fill",e=>this.color_polygon(t.properties)).on("mouseover",(e,o)=>{this.tooltip.html(this.hover_text(t.properties)).style("visibility","visible")}).on("mousemove",(e,o)=>{this.tooltip.style("top",e.pageY-10+"px").style("left",e.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(e,o)=>this.clicked(o))},getPolygonId(t){let e=t.region,o=[" ","&","(",")","."];return t.state!=null&&(e=t.state),t.district!=null&&(e=t.district),o.forEach(r=>{e=e.replaceAll(r,"_")}),e},clicked(t){let e={name:t.properties[this.mode],value:0,mode:this.mode},o=this.mapData.find(r=>r.name==e.name);e.value=o?o.value:0,this.$emit("polygon-clicked",e)},drawPolygonBoundary(t){this.polygons.append("g").data([t]).enter().append("path").classed("state-boundary",!0).classed("selected-polygon",e=>this.selected.state&&e.properties.state==this.selected.state||this.selected.region&&e.properties.region==this.selected.region).attr("properties",e=>JSON.stringify(e.properties)).attr("d",this.path).attr("id",this.getPolygonId(t.properties))},drawPolygonLabel(t,e){const o=this.regional_data[this.polygon_mode].find(c=>c[this.polygon_key]==e.properties[this.polygon_key]);let r="";o&&(r=this.format_number(o[this.data_mode])),t.append("g").data([e]).enter().append("text").classed("poly_text",!0).attr("x",c=>this.path.centroid(c)[0]).attr("y",c=>this.path.centroid(c)[1]).classed("small-text",!0).attr("text-anchor","middle").text(r).on("mouseover",()=>{this.tooltip.html(this.hover_text(e.properties)).style("visibility","visible")}).on("mousemove",(c,_)=>{this.tooltip.style("top",c.pageY-10+"px").style("left",c.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(c,_)=>this.clicked(_))},color_polygon(t){let e=this.mapData.find(o=>o.name==t[this.mode]);return e?this.colors(e.value):this.colors(0)},handleZoom(t){this.zoomTransform=t.transform;let e=1/t.transform.k*.8;this.svg.selectAll(".poly_text").attr("transform",t.transform).style("font-size",`${e}rem`),this.svg.selectAll("path").attr("transform",t.transform),this.svg.selectAll("circle").attr("transform",t.transform).attr("r",e)},hover_text(t){var o;let e=["state","district"].map(r=>`<tr><td>${this.capitalizeWords(r)}</td><td>${t[r]?t[r]:"-"}</td></tr>`);return e.push(`<tr><td>${this.tooltip_third_row_label}</td><td>${((o=this.mapData.find(r=>r.name==t[this.mode]))==null?void 0:o.value)||0}</td></tr>`),`<table border='1' class='d3-tooltip'>${e.join(`
`)}</table>`},format_number(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},capitalizeWords(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}}}),Lt={class:"switcher switcher-sm text-center py-2 bg-dark"},St=["onClick","textContent"],Ft=s("div",{id:"map"},[s("div",{id:"map-container"})],-1);function jt(t,e,o,r,c,_){return a(),l(h,null,[s("div",Lt,[(a(!0),l(h,null,f(t.modes,n=>(a(),l("button",{class:A(["btn mx-1",n===t.mode?"btn-success":"btn-outline-success bg-light"]),key:n,onClick:i=>t.mode=n,textContent:m(n)},null,10,St))),128))]),Ft],64)}const zt=y(Mt,[["render",jt]]);const xt=v({name:"MapDistrictCoordinator",components:{MapComponent:zt},emits:["polygon-clicked"],data(){return{geojson:{district:L,state:M},mode:"state"}},computed:{...$({district_coordinators:t=>t.district_coordinators.all_data}),map_data(){let t={states:this.geojson.state.features.map(o=>o.properties.state),districts:this.geojson.district.features.map(o=>o.properties.district)},e={state:t.states.map(o=>({name:o,value:0})),district:t.districts.map(o=>({name:o,value:0}))};return this.district_coordinators.forEach(o=>{e.state.find((r,c)=>o.state==this.valueFromLabel(r.name)).value+=1,e.district.forEach(r=>{o.district==this.valueFromLabel(r.name)&&(r.value+=1)})}),e}},mounted(){},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},polygonClick(t){this.$emit("polygon-clicked",t)}}}),At={class:"map-container border border-danger rounded"};function Vt(t,e,o,r,c,_){const n=b("map-component");return a(),l("div",At,[w(n,{geojson:t.geojson[t.mode],data:t.map_data,modes:["state","district"],tooltip_third_row_label:"Coordinator(/s)",onModeChange:e[0]||(e[0]=i=>t.mode=i),onPolygonClicked:t.polygonClick},null,8,["geojson","data","onPolygonClicked"])])}const It=y(xt,[["render",Vt]]);const Nt=v({name:"DistrictCoordinators",components:{ModalAddDistrictCoordinator:ct,ModalViewDistrictCoordinators:Dt,MapDistrictCoordinator:It},data(){return{show_add_modal:!1,show_view_modal:!1,headers:[{value:"id",label:"Sl. No."},{value:"name",label:"Name"},{value:"state",label:"State"},{value:"district",label:"District"}],sort_col:"id",sort_dir:"asc",selected_district_coordinator:null}},computed:{...$({user:t=>t.auth.user,all_data:t=>t.district_coordinators.all_data}),auth(){return this.user&&(this.user.user_type=="super_admin"||this.user.user_type=="admin")},table_data(){return this.all_data.sort((t,e)=>this.sort_dir=="asc"?t[this.sort_col]>e[this.sort_col]?1:-1:t[this.sort_col]<e[this.sort_col]?1:-1)}},created(){z.dispatch("district_coordinators/getAllData")},methods:{polygonClick(t){let e=this.all_data.filter(o=>o.state==this.valueFromLabel(t.name)||o.district==this.valueFromLabel(t.name));this.selected_district_coordinator=e,this.show_view_modal=!0},showViewModal(t){this.selected_district_coordinator=[t],this.show_view_modal=!0},valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},getStateName(t){var e;return t==-1?"":(e=M.features.find(o=>this.valueFromLabel(o.properties.state)==t))==null?void 0:e.properties.state},getDistrictName(t){var e;return t==-1?"":(e=L.features.find(o=>this.valueFromLabel(o.properties.district)==t))==null?void 0:e.properties.district},headerSortClass(t){if(t==this.sort_col)return this.sort_dir=="asc"?"sort-asc":"sort-desc"},headerClick(t){t==this.sort_col?this.sort_dir=this.sort_dir=="asc"?"desc":"asc":(this.sort_col=t,this.sort_dir="asc")},deleteDistrictCoordinator(t){confirm("Are you sure you want to delete this District Coordinator?")&&z.dispatch("district_coordinators/delete",t)}}}),Pt=t=>(k("data-v-1de7ffd3"),t=t(),D(),t),Ut={class:"container-fluid"},Et={class:"header d-flex px-2"},Bt=Pt(()=>s("div",{class:"h1"},"District Coordinators",-1)),Ot={key:0},qt={class:"main-container m-4"},Tt={class:"table table-primary"},Wt=["textContent","onClick"],Xt={key:0,class:"bg-warning text-center"},Yt=["onClick"],Ht=["textContent"],Zt=["textContent"],Jt=["textContent"],Rt=["textContent"],Gt={key:0,class:"table-warning text-center"},Kt=["onClick"];function Qt(t,e,o,r,c,_){const n=b("map-district-coordinator"),i=b("modal-view-district-coordinators"),d=b("modal-add-district-coordinator");return a(),l("div",Ut,[s("div",Et,[Bt,t.auth?(a(),l("div",Ot,[s("button",{class:"btn btn-lg btn-success mx-5",onClick:e[0]||(e[0]=p=>t.show_add_modal=!0),title:"Add District Coordinator"},"+")])):u("",!0)]),s("div",qt,[s("table",Tt,[s("thead",null,[s("tr",null,[(a(!0),l(h,null,f(t.headers,p=>(a(),l("th",{key:p.value,textContent:m(p.label),class:A(["bg-primary",t.headerSortClass(p.value)]),onClick:S=>t.headerClick(p.value)},null,10,Wt))),128)),t.auth?(a(),l("th",Xt,"Actions")):u("",!0)])]),s("tbody",null,[(a(!0),l(h,null,f(t.table_data,p=>(a(),l("tr",{key:p.id,onClick:S=>t.showViewModal(p)},[s("td",{textContent:m(p.id)},null,8,Ht),s("td",{textContent:m(p.name)},null,8,Zt),s("td",{textContent:m(t.getStateName(p.state))},null,8,Jt),s("td",{textContent:m(t.getDistrictName(p.district))},null,8,Rt),t.auth?(a(),l("td",Gt,[s("button",{class:"btn delete-btn badge btn-danger",onClick:P(S=>t.deleteDistrictCoordinator(p.id),["stop"]),title:"Delete District Coordinator"}," X ",8,Kt)])):u("",!0)],8,Yt))),128))])]),w(n,{onPolygonClicked:t.polygonClick},null,8,["onPolygonClicked"]),w(i,{show:t.show_view_modal,data:t.selected_district_coordinator,onClose:e[1]||(e[1]=p=>t.show_view_modal=!1)},null,8,["show","data"])]),w(d,{show:t.show_add_modal,onClose:e[2]||(e[2]=p=>t.show_add_modal=!1)},null,8,["show"])])}const ae=y(Nt,[["render",Qt],["__scopeId","data-v-1de7ffd3"]]);export{ae as D};

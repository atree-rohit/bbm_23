import{g as Q,m as tt,B as et,_ as P,o as d,c as u,b as a,n as T,t as _,F as y,l as S,d as D,w as V,v as K,D as st,E as R,G as k,H as x,I as W,J as Y,K as at,h as q,j as F,L as ot,p as nt,k as lt,f as it,s as rt}from"./_plugin-vue_export-helper-c853a411.js";import{z as ct,m as J,i as dt,s as j}from"./viridis-c5d63127.js";function U(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}const ut=Q({name:"MapCleanData",props:{data:{type:Array,required:!0},modes:{type:Array,required:!0}},emits:["mode-change","polygon-clicked"],data(){return{mode:"districts",polygons:null,path:null,svg:null,projection:null,colors:null,max:null,height:500,width:500,zoomTransform:0,tooltip:null,showMap:!1}},watch:{mode(t){this.$emit("mode-change",t)},data(t){console.log("data changed"),this.init()}},computed:{...tt({geojson:t=>t.data.geojson}),current_geojson(){return!this.geojson||!this.mode?{}:this.geojson[this.mode]},zoom(){return ct().scaleExtent([.5,250]).translateExtent([[-.5*this.width,-.75*this.height],[2.5*this.width,2.5*this.height]]).on("zoom",this.handleZoom)},mode_key(){return{countries:"country",states:"state",districts:"district"}[this.mode]}},created(){this.geojson&&this.geojson.features&&(console.log("mounted: initializing"),this.init())},updated(){console.log("updated: re-initializing"),this.init()},methods:{init(){this.showMap&&this.current_geojson.features?(this.init_variables(),this.init_svg(),this.render_map()):console.log("No geojson")},init_variables(){this.polygons=null,this.path=null,this.svg={},this.height=window.innerHeight*.8,this.width=window.innerWidth*.5,window.innerWidth<800?(this.height=window.innerHeight*.6,this.projection=J().scale(600).center([110,20])):this.projection=J().scale(1e3).center([80,27.5]),this.path=dt().projection(this.projection),this.tooltip=this.init_tooltip()},init_tooltip(){return j("body .d3-tooltip").empty()||j("body .d3-tooltip").remove(),j("body").append("div").attr("class","d3-tooltip").style("position","absolute").style("top","0").style("z-index","2000").style("visibility","hidden").style("padding","10px").style("background","rgba(0,0,0,0.75)").style("border-radius","4px").style("color","#fff").text("a simple tooltip")},init_svg(){j("#map-container svg.svg-content").empty()||j("#map-container svg.svg-content").remove(),this.svg=j("#map-container").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",this.width).attr("height",this.height).classed("svg-content",!0),this.zoomTransform||(this.zoomTransform=et(this.svg.node()))},render_map(){let t=this.svg.append("g").classed("map-boundary",!0).selectAll("path").append("g");this.svg.append("g").classed("map-labels",!0).selectAll("text").append("g"),this.polygons=t.append("g").classed("polygons",!0),this.current_geojson.features.forEach(e=>{this.drawPolygon(e)}),this.drawPoints(),this.svg.call(this.zoom),this.svg.call(this.zoom.transform,this.zoomTransform)},drawPoints(){const t=this.svg.append("g").classed("points",!0),e=[];this.data.forEach(i=>{const{longitude:n,latitude:o}=i;if(o&&!isNaN(o)&&n&&!isNaN(n)){const[r,s]=this.projection([n,o]);t.append("circle").attr("cx",r).attr("cy",s).attr("r","10px").classed("point",!0)}else e.push(i)}),e.length&&console.warn("Missing Coordinates:",e)},drawPolygon(t){this.polygons.append("g").data([t]).enter().append("path").attr("d",this.path).classed("polygon",!0).on("mouseover",(e,i)=>{this.tooltip.html(this.hover_text(t.properties)).style("visibility","visible")}).on("mousemove",(e,i)=>{this.tooltip.style("top",e.pageY-10+"px").style("left",e.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(e,i)=>this.clicked(i))},getPolygonId(t){let e=t.region,i=[" ","&","(",")","."];return t.state!=null&&(e=t.state),t.district!=null&&(e=t.district),i.forEach(n=>{e=e.replaceAll(n,"_")}),e},clicked(t){console.log(t);const{state:e,district:i,country:n}=t.properties;let o={};n!=null&&(o.country=n,this.$emit("polygon-clicked",o),this.showMap=!1);let r=[];e&&(r.push(e),o.state=e),i&&(o.district=i,o.country="India"),r.length&&(this.$emit("polygon-clicked",o),r=r.join(" "),navigator.clipboard.writeText(r),this.showMap=!1)},drawPolygonBoundary(t){this.polygons.append("g").data([t]).enter().append("path").classed("state-boundary",!0).classed("selected-polygon",e=>this.selected.state&&e.properties.state==this.selected.state||this.selected.region&&e.properties.region==this.selected.region).attr("properties",e=>JSON.stringify(e.properties)).attr("d",this.path).attr("id",this.getPolygonId(t.properties))},drawPolygonLabel(t,e){const i=this.regional_data[this.polygon_mode].find(o=>o[this.polygon_key]==e.properties[this.polygon_key]);let n="";i&&(n=this.format_number(i[this.data_mode])),t.append("g").data([e]).enter().append("text").classed("poly_text",!0).attr("x",o=>this.path.centroid(o)[0]).attr("y",o=>this.path.centroid(o)[1]).classed("small-text",!0).attr("text-anchor","middle").text(n).on("mouseover",()=>{this.tooltip.html(this.hover_text(e.properties)).style("visibility","visible")}).on("mousemove",(o,r)=>{this.tooltip.style("top",o.pageY-10+"px").style("left",o.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(o,r)=>this.clicked(r))},color_polygon(t){let e=this.mapData.find(i=>i.name==t[this.mode_key]);return e?this.colors(e.value):this.colors(0)},handleZoom(t){this.zoomTransform=t.transform;let e=1/t.transform.k*.8;this.svg.selectAll(".poly_text").attr("transform",t.transform).style("font-size",`${e}rem`),this.svg.selectAll("path").attr("transform",t.transform),this.svg.selectAll("circle").attr("transform",t.transform).attr("r",e*5)},hover_text(t){let e=Object.entries(t).filter(([i,n])=>i!="id");return e=e.map(([i,n])=>`<tr><td>${U(i)}</td><td>${U(n)}</td></tr>`),`<table border='1' class='d3-tooltip'>${e.join(`
`)}</table>`},format_number(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}}),pt={class:"text-center"},ht={key:0,class:"main-container"},vt={class:"switcher switcher-sm text-center py-2 bg-dark"},gt=["onClick","textContent"],mt=a("div",{id:"map"},[a("div",{id:"map-container"})],-1);function _t(t,e,i,n,o,r){return d(),u(y,null,[a("div",pt,[a("button",{class:T(["btn",t.showMap?"btn-danger btn-sm":"btn-success btn-lg"]),onClick:e[0]||(e[0]=s=>t.showMap=!t.showMap)},_(t.showMap?"Hide":"Show")+" Map ",3)]),t.showMap?(d(),u("div",ht,[a("div",vt,[(d(!0),u(y,null,S(t.modes,s=>(d(),u("button",{class:T(["btn mx-1",s===t.mode?"btn-success":"btn-outline-success bg-light"]),key:s,onClick:b=>t.mode=s,textContent:_(s)},null,10,gt))),128))]),mt])):D("",!0)],64)}const ft=P(ut,[["render",_t]]);const bt={name:"AutoComplete",props:{suggestions:{type:Array,required:!0},value:{type:String,required:!0}},emits:["selected"],data(){return{searchText:"",showSuggestions:!1,filteredSuggestions:[],typingTimer:null,typingTimeout:300}},watch:{value(t,e){this.searchText=t,e.length==0&&this.handleInput()}},methods:{handleInput(){clearTimeout(this.typingTimer),this.searchText.length>=2?this.typingTimeout=setTimeout(()=>{this.filteredSuggestions=this.suggestions.filter(t=>t.toLowerCase().includes(this.searchText.toLowerCase())),this.showSuggestions=!0},this.typingTimeout):(this.filteredSuggestions=[],this.showSuggestions=!1)},selectSuggestion(t){this.searchText=t,this.showSuggestions=!1,this.$emit("selected",t)}}},yt={key:0},xt=["onClick"];function wt(t,e,i,n,o,r){return d(),u(y,null,[V(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>o.searchText=s),placeholder:"Enter Taxon",class:"form-control",onInput:e[1]||(e[1]=(...s)=>r.handleInput&&r.handleInput(...s)),onKeydown:e[2]||(e[2]=st((...s)=>r.selectSuggestion&&r.selectSuggestion(...s),["enter"]))},null,544),[[K,o.searchText]]),o.showSuggestions?(d(),u("ul",yt,[(d(!0),u(y,null,S(o.filteredSuggestions,(s,b)=>(d(),u("li",{key:b,onClick:z=>r.selectSuggestion(s)},_(s),9,xt))),128))])):D("",!0)],64)}const kt=P(bt,[["render",wt],["__scopeId","data-v-e12b96f2"]]);const Ct=t=>(nt("data-v-fca6fa1d"),t=t(),lt(),t),$t={key:0,class:"modal fade show","aria-modal":"true",role:"dialog"},St={class:"modal-dialog modal-lg"},Tt={class:"modal-content"},Mt={class:"modal-header"},jt={class:"modal-title",id:"exampleModalLiveLabel"},zt={class:"modal-body"},Nt={class:"form-container"},At=["onUpdate:modelValue"],It={for:"exampleInputEmail1",class:"form-label"},Dt={class:"taxa-lookup-container p-2 row mx-0",style:{"background-color":"#aaa"}},Ot={class:"col"},Et={class:"form-check form-switch"},Pt=Ct(()=>a("label",{class:"form-check-label",for:"flexSwitchCheckChecked"},"validated",-1)),Bt={key:1,class:"modal-backdrop fade show"},Lt={name:"ModalEditObservation",props:{show:{type:Boolean,default:!1},data:{type:Object,required:!0}},mounted(){},computed:{show_map(){return this.data.latitude&&this.data.longitude&&(this.data.state==null||this.data.district==null)}},watch:{show(t){this.current_district_coordinator_id=0;let e=document.querySelector("body");t==!0?e.classList.add("modal-open"):e.classList.remove("modal-open")}},methods:{}},Vt=Object.assign(Lt,{props:{show:{type:Boolean,default:!1},data:{type:Object,required:!0}},emits:["close"],setup(t,{emit:e}){const i=t,n=R(),o=k(()=>{const{latitude:c,longitude:v}=s.value;return[{latitude:c,longitude:v}]}),r=()=>{C.value="",e("close")},s=x({}),b=["user","observed_on","place","country","state","district","latitude","longitude","taxa_id","species"];k(()=>i.data.state==null||i.data.district==null),W(()=>i.data,c=>{s.value=JSON.parse(JSON.stringify(c))});const z=c=>{const v={present:"border border-success",absent:"border border-danger"};if(c==="place"||c==="species")return"border border-secondary";const g=s.value[c];return c==="observed_on"?M(g)?v.present:v.absent:g&&typeof g=="string"&&g.length>1||typeof g=="number"&&g>0?v.present:v.absent},M=c=>!c||/^(202[0-3])-09-\d{2}$/.test(c),N=()=>{n.dispatch("clean_data/updateData",s.value),r()};Y(()=>{n.dispatch("data/getTaxa",s.value)});const A=k(()=>n.state.data.taxa.map(c=>`${c.name}-${c.id}`)),C=x(""),m=c=>{const v=c.split("-");console.log(s.value,v),s.value.species===v[0]&&s.value.taxa_id==null&&(s.value.taxa_id=v[1]),C.value=c},O=()=>{C.value=s.value.species},B=c=>{console.log(c,s.value),s.value.country==null&&(s.value.country=c.country),s.value.state==null&&(s.value.state=c.state),s.value.district==null&&(s.value.district=c.district)};return(c,v)=>(d(),u(y,null,[t.show?(d(),u("div",$t,[a("div",St,[a("div",Tt,[a("div",Mt,[a("h3",jt,"Observation Details ["+_(t.data.portal)+" # "+_(t.data.id)+"]",1),a("button",{type:"button",class:"btn-close",onClick:r})]),a("div",zt,[a("div",Nt,[(d(),u(y,null,S(b,g=>a("div",{class:"form-floating",key:g},[V(a("input",{class:T(["form-control",z(g)]),"onUpdate:modelValue":L=>s.value[g]=L},null,10,At),[[K,s.value[g]]]),a("label",It,_(at(U)(g)),1)])),64))]),a("div",Dt,[a("div",Ot,[q(kt,{suggestions:A.value,value:C.value,onSelected:m},null,8,["suggestions","value"])]),a("div",{class:"col-1"},[a("button",{class:"btn btn-success px-2 ms-3",onClick:O},"📋")])]),F(" "+_(C.value)+" ",1),a("div",Et,[V(a("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":v[0]||(v[0]=g=>s.value.validated=g)},null,512),[[ot,s.value.validated]]),Pt]),a("div",null,[q(ft,{data:o.value,modes:["countries","states","districts"],onPolygonClicked:B},null,8,["data"])])]),a("div",{class:"modal-footer"},[a("button",{type:"button",class:"btn btn-secondary",onClick:r},"Close"),a("button",{type:"button",class:"btn btn-success",onClick:N},"Save changes")])])])])):D("",!0),t.show?(d(),u("div",Bt)):D("",!0)],64))}}),qt=P(Vt,[["__scopeId","data-v-fca6fa1d"]]);const Ut={class:"btn-rows bg-secondary"},Ht={class:"btn-group w-100 p-1"},Jt=["textContent","onClick"],Kt={class:"btn-group w-100 p-1"},Rt=["textContent","onClick"],Wt={class:"page-info"},Yt={key:0,class:"table-container border border-danger"},Ft={class:"table table-sm table-hover"},Gt={class:"bg-dark text-light"},Xt=["textContent","onClick"],Zt=["onClick"],Qt=["textContent"],te={__name:"CleanData",setup(t){const e=R(),i=["counts","inat","ibp","ifb"],n=x(null),o=["all","validated","unvalidated"],r=x("all"),s=x("id"),b=x("asc"),z=x(1e3),M=x(1),N=x(!1),A=x({});Y(()=>{e.dispatch("data/getMaps")});const C=k(()=>n.value?{portal:n.value,per_page:z.value,page_no:M.value}:{});W(C,(p,f)=>{p!==f&&e.dispatch("clean_data/getData",C.value)});const m=k(()=>e.getters["clean_data/data_with_classes"]),O=k(()=>e.state.clean_data.total_records),B=k(()=>{let p=[];if(m&&m.value&&m.value[0])switch(r.value){case"all":p=m.value;break;case"validated":p=m.value.filter(f=>f.validated);break;case"unvalidated":p=m.value.filter(f=>!f.validated);break}return p}),c=k(()=>m&&m.value&&m.value[0]?B.value.sort((p,f)=>{const l=$=>$===null?typeof $=="number"?0:typeof $=="boolean"?!1:"":$,h=l(p[s.value]),w=l(f[s.value]),I=$=>!isNaN($),E=$=>typeof $=="boolean";return I(h)&&I(w)||E(h)&&E(w)?b.value==="asc"?h-w:w-h:b.value==="asc"?h.localeCompare(w):w.localeCompare(h)}):[]),v=k(()=>m&&m.value&&m.value[0]?["id","user","observed_on","place","country","state","district","latitude","longitude","taxa_id","species","validated"]:[]),g=p=>{s.value===p?b.value=b.value==="asc"?"desc":"asc":(s.value=p,b.value="asc"),console.log(p,s.value,b.value)},L=p=>{A.value={...p,portal:n.value},N.value=!0},G=()=>{A.value={},N.value=!1},X=p=>p.classes.all?"table-success":"table-danger",Z=(p,f)=>{const h={observed_on:"classes.date",user:"classes.user",country:"classes.location.country",state:"classes.location.state",district:"classes.location.district",latitude:"classes.location.latitude",longitude:"classes.location.longitude",taxa_id:"classes.taxon.taxa_id",species:"classes.taxon.species",validated:"validated"}[f];return h?h.split(".").reduce((I,E)=>I&&I[E],p)?"table-success":"table-danger":"table-warning"};return(p,f)=>(d(),u(y,null,[a("div",Ut,[a("div",Ht,[(d(),u(y,null,S(i,l=>a("button",{class:T(["btn btn-sm mx-2 rounded",{"btn-success":l===n.value,"btn-outline-light":l!==n.value}]),key:l,textContent:_(l),onClick:h=>n.value=n.value==l?null:l},null,10,Jt)),64))]),a("div",Kt,[(d(),u(y,null,S(o,l=>a("button",{class:T(["btn btn-sm mx-2 rounded",{"btn-success":l===r.value,"btn-outline-light":l!==r.value}]),key:l,textContent:_(l),onClick:h=>r.value=r.value==l?null:l},null,10,Rt)),64))]),a("div",Wt,[a("button",{class:"btn btn-sm btn-info",onClick:f[0]||(f[0]=l=>M.value--)}," < "),a("span",null,"Page "+_(M.value)+" of "+_(Math.ceil(O.value/z.value)),1),a("button",{class:"btn btn-sm btn-info",onClick:f[1]||(f[1]=l=>M.value++)}," > "),F(" Total Records: "+_(O.value),1)])]),n.value?(d(),u("div",Yt,[a("table",Ft,[a("thead",Gt,[a("tr",null,[(d(!0),u(y,null,S(v.value,l=>(d(),u("th",{key:l,textContent:_(l),onClick:h=>g(l)},null,8,Xt))),128))])]),a("tbody",null,[(d(!0),u(y,null,S(c.value,l=>(d(),u("tr",{key:l.id,onClick:h=>L(l),class:T(X(l))},[(d(!0),u(y,null,S(v.value,h=>(d(),u("td",{key:h,textContent:_(l[h]),class:T(Z(l,h))},null,10,Qt))),128))],10,Zt))),128))])])])):D("",!0),q(qt,{show:N.value,data:A.value,onClose:G},null,8,["show","data"]),a("pre",null,"        "+_(m.value[0])+`
    `,1)],64))}},ee=P(te,[["__scopeId","data-v-1504c80f"]]),H=it({});H.component("clean-data",ee);H.use(rt);H.mount("#app");

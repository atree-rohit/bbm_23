import{g as k,m as x,e as A,_ as f,c as i,b as o,F as p,j as _,d as u,o as r,t as m,w as v,v as j,q as M,p as $,i as D,x as F,n as L,r as b,k as y,y as N,s as w,u as V}from"./_plugin-vue_export-helper-d6384633.js";import{z as P,m as S,i as E,s as g,a as I,l as U,c as O,f as B}from"./indexRollupNext-dc2a322c.js";const T=k({name:"ModalAddPartner",props:{show:{type:Boolean,default:!1}},emits:["close"],data(){return{form_questions:[{type:"text",label:"Name",name:"name",required:!0},{type:"text",label:"Organization / Designation",name:"designation",required:!1},{type:"select",label:"State",name:"state",required:!0,options:[]},{type:"select",label:"District",name:"district",required:!0,options:[]},{type:"text",label:"Coordinates (Latitude, Longitude)",name:"coordinates",required:!1},{type:"text",label:"Email",name:"email",required:!1},{type:"text",label:"Phone Number",name:"phone",required:!1}],form_data:{}}},created(){this.initFormData()},watch:{show(t){let e=document.querySelector("body");t==!0?e.classList.add("modal-open"):e.classList.remove("modal-open")},geojson(){this.initSelectOptions(),(this.user.user_type=="admin"||this.user.user_type=="super_admin")&&(this.form_data.state="jammu_&_kashmir",this.form_data.state=-1)}},computed:{...x({user:t=>t.auth.user,geojson:t=>t.data.geojson}),select_district_options(){let t=[];if(this.form_data.state=="-1")t.push({label:"Select State First",value:"-1"});else{t.push({label:"Select District",value:"-1"});let e=[];this.geojson.districts.features.map(s=>{this.valueFromLabel(s.properties.state)==this.form_data.state&&e.push({label:s.properties.district.trim(),value:this.valueFromLabel(s.properties.district.trim())})}),t=t.concat(e.sort((s,l)=>s.label<l.label?-1:s.label>l.label?1:0))}return t}},methods:{...A({store:"district_coordinators/store",importDC:"district_coordinators/importDC"}),initSelectOptions(){this.form_questions[2].options=this.geojson.states.features.map(t=>({label:t.properties.state.trim(),value:this.valueFromLabel(t.properties.state.trim())})).sort((t,e)=>t.label<e.label?-1:t.label>e.label?1:0)},initFormData(){this.form_data={name:"",designation:"",district:"-1",state:"-1",coordinates:"",email:"",phone:"",user:this.user}},valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},closeModal(){this.$emit("close")},submit(){this.store(this.form_data),this.initFormData(),this.closeModal()}}}),W=t=>($("data-v-130b467e"),t=t(),D(),t),q={key:0,class:"modal fade show","aria-modal":"true",role:"dialog"},H={class:"modal-dialog modal-lg"},X={class:"modal-content"},Y={class:"modal-header"},Z=W(()=>o("h3",{class:"modal-title",id:"exampleModalLiveLabel"},"Add District Coordinator",-1)),J={class:"modal-body"},R=["for","textContent"],G=["onUpdate:modelValue","placeholder"],K=["onUpdate:modelValue","placeholder"],Q=["onUpdate:modelValue"],tt={selected:"true",value:"-1"},et=["value","textContent"],st=["onUpdate:modelValue"],ot=["value","textContent"],at={class:"modal-footer"},it={key:1,class:"modal-backdrop fade show"};function rt(t,e,s,l,n,d){return r(),i(p,null,[t.show?(r(),i("div",q,[o("div",H,[o("div",X,[o("div",Y,[Z,o("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...a)=>t.closeModal&&t.closeModal(...a))})]),o("div",J,[o("form",{action:"javascript:void(0)",onSubmit:e[1]||(e[1]=(...a)=>t.submit&&t.submit(...a)),class:"row",method:"post"},[(r(!0),i(p,null,_(t.form_questions,a=>(r(),i("div",{key:a.name,class:"form-group col-12"},[o("label",{for:a.name,class:"font-weight-bold",textContent:m(a.label)},null,8,R),a.type=="text"?v((r(),i("input",{key:0,type:"text","onUpdate:modelValue":c=>t.form_data[a.name]=c,placeholder:`Enter ${a.name}`,class:"form-control"},null,8,G)),[[j,t.form_data[a.name]]]):a.type=="textarea"?v((r(),i("textarea",{key:1,"onUpdate:modelValue":c=>t.form_data[a.name]=c,placeholder:`Enter ${a.name}`,class:"form-control"},null,8,K)),[[j,t.form_data[a.name]]]):a.name=="state"?v((r(),i("select",{key:2,"onUpdate:modelValue":c=>t.form_data[a.name]=c,class:"form-select"},[o("option",tt,"Select "+m(a.label),1),(r(!0),i(p,null,_(a.options,c=>(r(),i("option",{key:c.value,value:c.value,textContent:m(c.label)},null,8,et))),128))],8,Q)),[[M,t.form_data[a.name]]]):a.name=="district"?v((r(),i("select",{key:3,"onUpdate:modelValue":c=>t.form_data[a.name]=c,class:"form-select"},[(r(!0),i(p,null,_(t.select_district_options,c=>(r(),i("option",{key:c.value,value:c.value,textContent:m(c.label)},null,8,ot))),128))],8,st)),[[M,t.form_data[a.name]]]):u("",!0)]))),128))],32)]),o("div",at,[o("button",{type:"button",class:"btn btn-secondary",onClick:e[2]||(e[2]=(...a)=>t.closeModal&&t.closeModal(...a))},"Close"),o("button",{type:"button",class:"btn btn-success",onClick:e[3]||(e[3]=(...a)=>t.submit&&t.submit(...a))},"Save changes")])])])])):u("",!0),t.show?(r(),i("div",it)):u("",!0)],64)}const lt=f(T,[["render",rt],["__scopeId","data-v-130b467e"]]);const nt={name:"ModalViewDistrictCoordinators",props:{show:{type:Boolean,default:!1},data:{type:Array,default:()=>[]}},emits:["close"],data(){return{form_questions:[{type:"text",label:"Name",name:"name",required:!0},{type:"text",label:"Organization / Designation",name:"designation",required:!1},{type:"select",label:"State",name:"state_name",required:!0,options:[]},{type:"select",label:"District",name:"district_name",required:!0,options:[]},{type:"text",label:"Coordinates (Latitude, Longitude)",name:"coordinates",required:!1},{type:"text",label:"Email",name:"email",required:!1}],current_district_coordinator_id:0}},created(){},watch:{show(t){this.current_district_coordinator_id=0;let e=document.querySelector("body");t==!0?e.classList.add("modal-open"):e.classList.remove("modal-open")}},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},closeModal(){this.$emit("close")}}},dt=t=>($("data-v-9773fde6"),t=t(),D(),t),ct={key:0,class:"modal fade show","aria-modal":"true",role:"dialog"},ht={class:"modal-dialog modal-lg"},mt={class:"modal-content"},ut={class:"modal-header"},pt=dt(()=>o("h3",{class:"modal-title",id:"exampleModalLiveLabel"},"View District Coordinator",-1)),_t={class:"modal-body"},gt={key:0,class:"btn-group mx-auto d-flex justify-content-center"},ft={class:"my-0 mx-5 h3"},vt={class:"table"},bt={class:"modal-footer"},yt={key:1,class:"modal-backdrop fade show"};function Ct(t,e,s,l,n,d){return r(),i(p,null,[s.show?(r(),i("div",ct,[o("div",ht,[o("div",mt,[o("div",ut,[pt,o("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...a)=>d.closeModal&&d.closeModal(...a))})]),o("div",_t,[s.data.length>=1?(r(),i("div",gt,[o("div",null,[n.current_district_coordinator_id>0?(r(),i("button",{key:0,class:"btn btn-outline-secondary",onClick:e[1]||(e[1]=a=>n.current_district_coordinator_id--)}," < ")):u("",!0)]),o("div",ft,m(n.current_district_coordinator_id+1),1),o("div",null,[n.current_district_coordinator_id<s.data.length-1?(r(),i("button",{key:0,class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=a=>n.current_district_coordinator_id++)}," > ")):u("",!0)])])):u("",!0),o("table",vt,[o("tbody",null,[(r(!0),i(p,null,_(n.form_questions,a=>(r(),i("tr",{key:a.name},[o("td",null,m(a.label),1),o("td",null,m(s.data[n.current_district_coordinator_id][a.name]),1)]))),128))])])]),o("div",bt,[o("button",{type:"button",class:"btn btn-secondary",onClick:e[3]||(e[3]=(...a)=>d.closeModal&&d.closeModal(...a))},"Close")])])])])):u("",!0),s.show?(r(),i("div",yt)):u("",!0)],64)}const wt=f(nt,[["render",Ct],["__scopeId","data-v-9773fde6"]]);const kt=k({name:"MapComponent",props:{geojson:{type:Object,required:!0},data:{type:Object,required:!0},modes:{type:Array,required:!0},tooltip_third_row_label:{type:String,default:""}},emits:["mode-change","polygon-clicked"],data(){return{mode:this.modes[0],polygons:null,path:null,svg:null,projection:null,colors:null,max:null,height:500,width:500,zoomTransform:0,tooltip:null}},watch:{mode(t){this.$emit("mode-change",t)},data(t){console.log("data changed"),this.init()}},computed:{mapData(){return this.data[this.mode]},zoom(){return P().scaleExtent([.5,250]).translateExtent([[-.5*this.width,-.75*this.height],[2.5*this.width,2.5*this.height]]).on("zoom",this.handleZoom)},mode_key(){return this.mode.slice(0,-1)}},mounted(){},updated(){console.log("updated: re-initializing"),this.init()},methods:{init(){console.log("init"),this.geojson.features?(this.init_variables(),this.init_legend(),this.init_svg(),this.render_map()):console.log("No geojson")},init_variables(){this.polygons=null,this.path=null,this.svg={},this.height=window.innerHeight*.8,this.width=window.innerWidth,window.innerWidth<800?(this.height=window.innerHeight*.6,this.projection=S().scale(600).center([110,20])):this.projection=S().scale(1e3).center([80,27.5]),this.path=E().projection(this.projection),this.tooltip=this.init_tooltip()},init_tooltip(){return g("body .d3-tooltip").empty()||g("body .d3-tooltip").remove(),g("body").append("div").attr("class","d3-tooltip").style("position","absolute").style("top","0").style("z-index","10").style("visibility","hidden").style("padding","10px").style("background","rgba(0,0,0,0.75)").style("border-radius","4px").style("color","#fff").text("a simple tooltip")},init_legend(){this.colors={},this.legend={},this.max=I(this.mapData,t=>t.value),this.colors=U().domain([0,1,this.max/3,this.max]).range(["#c33","#488","#fd0","#24ff00"]).clamp(!0),this.legend=O().shapeHeight(20).shapeWidth(60).scale(this.colors).labelFormat(B(",.0f")).orient("horizontal").labelOffset(-10).labelAlign("middle").cells(6)},init_svg(){g("#map-container svg.svg-content").empty()||g("#map-container svg.svg-content").remove(),this.svg=g("#map-container").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",this.width).attr("height",this.height).classed("svg-content",!0),this.zoomTransform||(this.zoomTransform=F(this.svg.node())),this.height>this.width&&this.legend.shapeWidth(35).cells(4)},render_map(){let t=this.svg.append("g").classed("map-boundary",!0).selectAll("path").append("g");this.svg.append("g").classed("map-labels",!0).selectAll("text").append("g"),this.polygons=t.append("g").classed("polygons",!0),this.geojson.features.forEach(e=>{this.drawPolygon(e)}),this.svg.append("g").attr("class","legend").attr("transform","translate("+this.width*.55+", 25)").call(this.legend),this.svg.call(this.zoom),this.svg.call(this.zoom.transform,this.zoomTransform)},drawPolygon(t){this.polygons.append("g").data([t]).enter().append("path").attr("d",this.path).attr("id",this.getPolygonId(t.properties)).attr("fill",e=>this.color_polygon(t.properties)).on("mouseover",(e,s)=>{this.tooltip.html(this.hover_text(t.properties)).style("visibility","visible")}).on("mousemove",(e,s)=>{this.tooltip.style("top",e.pageY-10+"px").style("left",e.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(e,s)=>this.clicked(s))},getPolygonId(t){let e=t.region,s=[" ","&","(",")","."];return t.state!=null&&(e=t.state),t.district!=null&&(e=t.district),s.forEach(l=>{e=e.replaceAll(l,"_")}),e},clicked(t){let e={name:t.properties[this.mode_key],value:0,mode:this.mode},s=this.mapData.find(l=>l.name==e.name);e.value=s?s.value:0,this.$emit("polygon-clicked",e)},drawPolygonBoundary(t){this.polygons.append("g").data([t]).enter().append("path").classed("state-boundary",!0).classed("selected-polygon",e=>this.selected.state&&e.properties.state==this.selected.state||this.selected.region&&e.properties.region==this.selected.region).attr("properties",e=>JSON.stringify(e.properties)).attr("d",this.path).attr("id",this.getPolygonId(t.properties))},drawPolygonLabel(t,e){const s=this.regional_data[this.polygon_mode].find(n=>n[this.polygon_key]==e.properties[this.polygon_key]);let l="";s&&(l=this.format_number(s[this.data_mode])),t.append("g").data([e]).enter().append("text").classed("poly_text",!0).attr("x",n=>this.path.centroid(n)[0]).attr("y",n=>this.path.centroid(n)[1]).classed("small-text",!0).attr("text-anchor","middle").text(l).on("mouseover",()=>{this.tooltip.html(this.hover_text(e.properties)).style("visibility","visible")}).on("mousemove",(n,d)=>{this.tooltip.style("top",n.pageY-10+"px").style("left",n.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(n,d)=>this.clicked(d))},color_polygon(t){let e=this.mapData.find(s=>s.name==t[this.mode_key]);return e?this.colors(e.value):this.colors(0)},handleZoom(t){this.zoomTransform=t.transform;let e=1/t.transform.k*.8;this.svg.selectAll(".poly_text").attr("transform",t.transform).style("font-size",`${e}rem`),this.svg.selectAll("path").attr("transform",t.transform),this.svg.selectAll("circle").attr("transform",t.transform).attr("r",e)},hover_text(t){var s;let e=["state","district"].map(l=>`<tr><td>${this.capitalizeWords(l)}</td><td>${t[l]?t[l]:"-"}</td></tr>`);return e.push(`<tr><td>${this.tooltip_third_row_label}</td><td>${((s=this.mapData.find(l=>l.name==t[this.mode_key]))==null?void 0:s.value)||0}</td></tr>`),`<table border='1' class='d3-tooltip'>${e.join(`
`)}</table>`},format_number(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},capitalizeWords(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}}}),xt={class:"switcher switcher-sm text-center py-2 bg-dark"},$t=["onClick","textContent"],Dt=o("div",{id:"map"},[o("div",{id:"map-container"})],-1);function jt(t,e,s,l,n,d){return r(),i(p,null,[o("div",xt,[(r(!0),i(p,null,_(t.modes,a=>(r(),i("button",{class:L(["btn mx-1",a===t.mode?"btn-success":"btn-outline-success bg-light"]),key:a,onClick:c=>t.mode=a,textContent:m(a)},null,10,$t))),128))]),Dt],64)}const Mt=f(kt,[["render",jt]]);const St=k({name:"MapDistrictCoordinator",components:{MapComponent:Mt},emits:["polygon-clicked"],data(){return{mode:"states"}},computed:{...x({district_coordinators:t=>t.district_coordinators.all_data,geojson:t=>t.data.geojson}),map_data(){let t={};if(this.geojson.states.features){let e={states:this.geojson.states.features.map(s=>s.properties.state),districts:this.geojson.districts.features.map(s=>s.properties.district)};t={states:e.states.map(s=>({name:s,value:0})),districts:e.districts.map(s=>({name:s,value:0}))},this.district_coordinators.forEach(s=>{t.states.find((l,n)=>s.state==this.valueFromLabel(l.name)).value+=1,t.districts.forEach(l=>{s.district==this.valueFromLabel(l.name)&&(l.value+=1)})})}return t}},mounted(){},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},polygonClick(t){this.$emit("polygon-clicked",t)}}}),Lt={class:"map-container rounded"};function zt(t,e,s,l,n,d){const a=b("map-component");return r(),i("div",Lt,[y(a,{geojson:t.geojson[t.mode],data:t.map_data,modes:["states","districts"],tooltip_third_row_label:"Coordinator(/s)",onModeChange:e[0]||(e[0]=c=>t.mode=c),onPolygonClicked:t.polygonClick},null,8,["geojson","data","onPolygonClicked"])])}const At=f(St,[["render",zt]]);const Ft={name:"DistrictCoordinators",components:{ModalAddDistrictCoordinator:lt,ModalViewDistrictCoordinators:wt,MapDistrictCoordinator:At},data(){return{show_add_modal:!1,show_view_modal:!1,headers:[{value:"id",label:"Sl. No."},{value:"name",label:"Name"},{value:"state",label:"State"},{value:"district",label:"District"}],sort_col:"id",sort_dir:"asc",selected_district_coordinator:null}},computed:{...x({user:t=>t.auth.user,all_data:t=>t.district_coordinators.all_data,geojson:t=>t.data.geojson}),auth(){return this.user&&(this.user.user_type=="super_admin"||this.user.user_type=="admin")},table_data(){return this.all_data.sort((t,e)=>this.sort_dir=="asc"?t[this.sort_col]>e[this.sort_col]?1:-1:t[this.sort_col]<e[this.sort_col]?1:-1)},chip_data(){return N(this.all_data,t=>t.state)},chips(){return this.chip_data.map(t=>({state:t[0],coordinators:t[1].length})).sort((t,e)=>e.coordinators-t.coordinators)}},created(){w.dispatch("data/getMaps"),w.dispatch("district_coordinators/getAllData")},methods:{polygonClick(t){let e=this.all_data.filter(l=>l.state==this.valueFromLabel(t.name)||l.district==this.valueFromLabel(t.name));if(e.length==0){alert(`Current No Coordinators set for ${t.name}`);return}const s=e.map(l=>({...l,state_name:this.getStateName(l.state),district_name:this.getDistrictName(l.district)}));this.selected_district_coordinator=s,this.show_view_modal=!0},showViewModal(t){let e={...t,state_name:this.getStateName(t.state),district_name:this.getDistrictName(t.district)};this.selected_district_coordinator=[e],this.show_view_modal=!0},valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},getStateName(t){var e;return t==-1||this.geojson.states.features==null?"":(e=this.geojson.states.features.find(s=>this.valueFromLabel(s.properties.state)==t))==null?void 0:e.properties.state},getDistrictName(t){var e;return t==-1||this.geojson.districts.features==null?"":(e=this.geojson.districts.features.find(s=>this.valueFromLabel(s.properties.district)==t))==null?void 0:e.properties.district},headerSortClass(t){if(t==this.sort_col)return this.sort_dir=="asc"?"sort-asc":"sort-desc"},headerClick(t){t==this.sort_col?this.sort_dir=this.sort_dir=="asc"?"desc":"asc":(this.sort_col=t,this.sort_dir="asc")},deleteDistrictCoordinator(t){confirm("Are you sure you want to delete this District Coordinator?")&&w.dispatch("district_coordinators/delete",t)}}},Nt=t=>($("data-v-0349521b"),t=t(),D(),t),Vt={class:"container-fluid"},Pt={class:"header d-flex px-2"},Et={class:"h1"},It={key:0},Ut={class:"main-container"},Ot={class:"chip-container"},Bt=["onClick"],Tt=["textContent"],Wt=["textContent"],qt=Nt(()=>o("div",{class:"coordinator-container"},null,-1)),Ht={key:0,class:"admin-container"},Xt={class:"table table-primary"},Yt=["textContent","onClick"],Zt={key:0,class:"bg-warning text-center"},Jt=["onClick"],Rt=["textContent"],Gt=["textContent"],Kt=["textContent"],Qt=["textContent"],te={key:0,class:"table-warning text-center"},ee=["onClick"];function se(t,e,s,l,n,d){const a=b("map-district-coordinator"),c=b("modal-view-district-coordinators"),z=b("modal-add-district-coordinator");return r(),i("div",Vt,[o("div",Pt,[o("div",Et,"District Coordinators ["+m(t.all_data.length)+"]",1),d.auth?(r(),i("div",It,[o("button",{class:"btn btn-lg btn-success mx-5",onClick:e[0]||(e[0]=h=>n.show_add_modal=!0),title:"Add District Coordinator"},"+")])):u("",!0)]),o("div",Ut,[o("div",Ot,[(r(!0),i(p,null,_(d.chips,h=>(r(),i("div",{class:"chip",key:h.state,onClick:C=>d.polygonClick({name:h.state})},[o("span",{class:"chip-state",textContent:m(d.getStateName(h.state))},null,8,Tt),o("span",{class:"chip-coordinator",textContent:m(h.coordinators)},null,8,Wt),qt],8,Bt))),128))]),y(a,{onPolygonClicked:d.polygonClick},null,8,["onPolygonClicked"]),y(c,{show:n.show_view_modal,data:n.selected_district_coordinator,onClose:e[1]||(e[1]=h=>n.show_view_modal=!1)},null,8,["show","data"])]),d.auth?(r(),i("div",Ht,[o("table",Xt,[o("thead",null,[o("tr",null,[(r(!0),i(p,null,_(n.headers,h=>(r(),i("th",{key:h.value,textContent:m(h.label),class:L(["bg-primary",d.headerSortClass(h.value)]),onClick:C=>d.headerClick(h.value)},null,10,Yt))),128)),d.auth?(r(),i("th",Zt,"Actions")):u("",!0)])]),o("tbody",null,[(r(!0),i(p,null,_(d.table_data,h=>(r(),i("tr",{key:h.id,onClick:C=>d.showViewModal(h)},[o("td",{textContent:m(h.id)},null,8,Rt),o("td",{textContent:m(h.name)},null,8,Gt),o("td",{textContent:m(d.getStateName(h.state))},null,8,Kt),o("td",{textContent:m(d.getDistrictName(h.district))},null,8,Qt),d.auth?(r(),i("td",te,[o("button",{class:"btn delete-btn badge btn-danger",onClick:V(C=>d.deleteDistrictCoordinator(h.id),["stop"]),title:"Delete District Coordinator"}," X ",8,ee)])):u("",!0)],8,Jt))),128))])])])):u("",!0),y(z,{show:n.show_add_modal,onClose:e[2]||(e[2]=h=>n.show_add_modal=!1)},null,8,["show"])])}const ie=f(Ft,[["render",se],["__scopeId","data-v-0349521b"]]);export{ie as D};

import{m as b,_ as g,c as i,b as s,t as n,d as M,o as l,p as k,k as C,g as D,r as m,h as S,j as v,F as _,x as j,s as B,i as h,n as O,f as q}from"./_plugin-vue_export-helper-5f9bfec6.js";import{M as L,d as U,s as x}from"./MapComponent-7f6a0b68.js";const I={name:"LoadingData",mounted(){console.log("LoadingData mounted")},computed:{...b({loading:t=>t.data.loading})}},u=t=>(k("data-v-59415fb2"),t=t(),C(),t),N={key:0,class:"loading-container"},P=u(()=>s("div",{class:"circle"},null,-1)),V=u(()=>s("div",{class:"circle"},null,-1)),F=u(()=>s("div",{class:"circle"},null,-1)),A=u(()=>s("div",{class:"circle"},null,-1)),E={class:"text"};function J(t,o,e,c,d,y){return t.loading?(l(),i("div",N,[P,V,F,A,s("div",E,n(t.loading),1)])):M("",!0)}const T=g(I,[["render",J],["__scopeId","data-v-59415fb2"]]);const z=D({name:"MapBBMData",components:{MapComponent:L,LoadingData:T},data(){return{geojson:{district:U,state:x},mode:"state",selected:{state:null,district:null}}},computed:{...b({district_coordinators:t=>t.district_coordinators.all_data,map_data:t=>t.data.map_data}),filtered_map_data(){let t=JSON.parse(JSON.stringify(this.map_data));return this.selected.state!=null&&(t.state=t.state.filter(o=>o.name===this.selected.state)),this.selected.district!=null&&(t.district=t.district.filter(o=>o.name===this.selected.district)),t}},mounted(){},watch:{map_data(t){console.log("mapData changed",t)}},methods:{valueFromLabel(t){return t.replace(/\s/g,"_").toLowerCase()},polygonClick(t){this.selected[t.mode]=this.selected[t.mode]===t.name?null:t.name,this.selected[t.mode==="state"?"district":"state"]=null}}}),R={class:"map-container border border-danger rounded"};function w(t,o,e,c,d,y){const p=m("loading-data"),a=m("map-component");return l(),i(_,null,[S(n(t.selected)+" ",1),s("div",R,[v(p),v(a,{geojson:t.geojson[t.mode],data:t.filtered_map_data,modes:["state","district"],tooltip_third_row_label:"Observations",onModeChange:o[0]||(o[0]=r=>t.mode=r),onPolygonClicked:t.polygonClick},null,8,["geojson","data","onPolygonClicked"])])],64)}const G=g(z,[["render",w]]);const H=D({name:"DataComponent",components:{MapBBMData:G},data(){return{filters:[{id:1,name:"Portals",active:!1},{id:2,name:"Location",active:!1},{id:3,name:"Taxa",active:!1},{id:4,name:"Date",active:!1},{id:5,name:"Users",active:!0}]}},computed:{...b({loading:t=>t.data.loading,observations:t=>t.data.observations,taxa:t=>t.data.taxa}),observation_stats(){return Object.keys(this.observations).length===0?(console.log("no observations"),{}):{counts:this.observationStats(this.observations.counts),inat:this.observationStats(this.observations.inats),ibp:this.observationStats(this.observations.ibps),ifb:this.observationStats(this.observations.ifbs),total:this.observationStats([].concat(...Object.values(this.observations)))}},observation_table_stats(){let t=[];for(let[o,e]of Object.entries(this.observation_stats))t.push({portal:o,observations:e.observations,users:e.users,states:e.states,districts:e.districts});return t},taxa_stats(){const t=Object.values(this.observations).flat();return j(this.taxa,e=>e.rank).map(e=>({rank:e[0],count:t.filter(c=>e[1].map(d=>d.id).includes(c[1])).length,unique:this.countUnique(e[1].map(c=>c.name))})).filter(e=>e.count>0)}},mounted(){B.dispatch("data/getAllData")},methods:{observationStats(t){return{observations:t.length,users:this.countUnique(t.map(e=>e[2])),states:this.countUnique(t.map(e=>e[4])),districts:this.countUnique(t.map(e=>e[5]))}},getObservationsCount(t){let o=0;return t.map(e=>{Object.keys(this.observations).forEach(c=>{o+=this.observations[c].filter(d=>d[1]==e.id).length})}),o},countUnique(t){return[...new Set(t)].length}}}),f=t=>(k("data-v-1e389c49"),t=t(),C(),t),K={class:"data-container"},Q={class:"filters"},W=f(()=>s("div",{class:"expand-btn"}," >> ",-1)),X={class:"filter-list"},Y=["onClick"],Z={class:"header"},tt={class:"canvas"},st={class:"observations"},et={class:"table table-sm"},at=f(()=>s("thead",{class:"bg-info"},[s("tr",null,[s("th",{scope:"col"},"Portal"),s("th",{scope:"col"},"Observations"),s("th",{scope:"col"},"Users"),s("th",{scope:"col"},"States"),s("th",{scope:"col"},"Districts")])],-1)),ot={class:"table-info"},nt={class:"table table-sm"},it=f(()=>s("thead",{class:"bg-danger text-light"},[s("tr",null,[s("th",null,"Rank"),s("th",null,"Count"),s("th",null,"Unique")])],-1)),lt={class:"table-danger"},ct={class:"taxa"};function dt(t,o,e,c,d,y){const p=m("MapBBMData");return l(),i(_,null,[s("div",K,[s("div",Q,[W,s("ul",X,[(l(!0),i(_,null,h(t.filters,a=>(l(),i("li",{key:a.id,class:O({active:a.active}),onClick:r=>a.active=!a.active},[s("div",Z,n(a.name),1)],10,Y))),128))])]),s("div",tt,[s("div",st,[s("table",et,[at,s("tbody",ot,[(l(!0),i(_,null,h(t.observation_table_stats,(a,r)=>(l(),i("tr",{key:r},[s("td",null,n(a.portal),1),s("td",null,n(a.observations),1),s("td",null,n(a.users),1),s("td",null,n(a.states),1),s("td",null,n(a.districts),1)]))),128))])]),s("table",nt,[it,s("tbody",lt,[(l(!0),i(_,null,h(t.taxa_stats,(a,r)=>(l(),i("tr",{key:r},[s("td",null,n(a.rank),1),s("td",null,n(a.count),1),s("td",null,n(a.unique),1)]))),128))])])]),s("div",ct,[v(p)])])]),S(" "+n(t.loading),1)],64)}const rt=g(H,[["render",dt],["__scopeId","data-v-1e389c49"]]),$=q({});$.component("DataComponent",rt);$.use(B);$.mount("#app");

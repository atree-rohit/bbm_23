import{g as tt,m as et,B as st,_ as B,o as c,c as u,b as s,n as j,t as _,F as f,l as k,d as O,w as E,v as J,D as ot,E as F,G as C,H as x,I as q,J as G,K as at,h as U,L as nt,p as lt,k as it,j as W,y as rt,f as dt,s as ct}from"./_plugin-vue_export-helper-a6d37d24.js";import{z as ut,m as Y,i as pt,s as N}from"./viridis-bde45e76.js";function H(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}const ht=tt({name:"MapCleanData",props:{data:{type:Array,required:!0},modes:{type:Array,required:!0}},emits:["mode-change","polygon-clicked"],data(){return{mode:"districts",polygons:null,path:null,svg:null,projection:null,colors:null,max:null,height:500,width:500,zoomTransform:0,tooltip:null,showMap:!1}},watch:{mode(t){this.$emit("mode-change",t)},data(t){console.log("data changed"),this.init()}},computed:{...et({geojson:t=>t.data.geojson}),current_geojson(){return!this.geojson||!this.mode?{}:this.geojson[this.mode]},zoom(){return ut().scaleExtent([.5,250]).translateExtent([[-.5*this.width,-.75*this.height],[2.5*this.width,2.5*this.height]]).on("zoom",this.handleZoom)},mode_key(){return{countries:"country",states:"state",districts:"district"}[this.mode]}},created(){this.geojson&&this.geojson.features&&(console.log("mounted: initializing"),this.init())},updated(){console.log("updated: re-initializing"),this.init()},methods:{init(){this.showMap&&this.current_geojson.features?(this.init_variables(),this.init_svg(),this.render_map()):console.log("No geojson")},init_variables(){this.polygons=null,this.path=null,this.svg={},this.height=window.innerHeight*.6,this.width=window.innerWidth*.4,window.innerWidth<800?(this.height=window.innerHeight*.6,this.projection=Y().scale(600).center([110,20])):this.projection=Y().scale(750).center([90,22.5]),this.path=pt().projection(this.projection),this.tooltip=this.init_tooltip()},init_tooltip(){return N("body .d3-tooltip").empty()||N("body .d3-tooltip").remove(),N("body").append("div").attr("class","d3-tooltip").style("position","absolute").style("top","0").style("z-index","2000").style("visibility","hidden").style("padding","10px").style("background","rgba(0,0,0,0.75)").style("border-radius","4px").style("color","#fff").text("a simple tooltip")},init_svg(){N("#map-container svg.svg-content").empty()||N("#map-container svg.svg-content").remove(),this.svg=N("#map-container").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("width",this.width).attr("height",this.height).classed("svg-content",!0),this.zoomTransform||(this.zoomTransform=st(this.svg.node()))},render_map(){let t=this.svg.append("g").classed("map-boundary",!0).selectAll("path").append("g");this.svg.append("g").classed("map-labels",!0).selectAll("text").append("g"),this.polygons=t.append("g").classed("polygons",!0),this.current_geojson.features.forEach(e=>{this.drawPolygon(e)}),this.drawPoints(),this.svg.call(this.zoom),this.svg.call(this.zoom.transform,this.zoomTransform)},drawPoints(){const t=this.svg.append("g").classed("points",!0),e=[];this.data.forEach(i=>{const{longitude:l,latitude:n}=i;if(n&&!isNaN(n)&&l&&!isNaN(l)){const[r,o]=this.projection([l,n]);t.append("circle").attr("cx",r).attr("cy",o).attr("r","10px").classed("point",!0)}else e.push(i)}),e.length&&console.warn("Missing Coordinates:",e)},drawPolygon(t){this.polygons.append("g").data([t]).enter().append("path").attr("d",this.path).classed("polygon",!0).on("mouseover",(e,i)=>{this.tooltip.html(this.hover_text(t.properties)).style("visibility","visible")}).on("mousemove",(e,i)=>{this.tooltip.style("top",e.pageY-10+"px").style("left",e.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(e,i)=>this.clicked(i))},getPolygonId(t){let e=t.region,i=[" ","&","(",")","."];return t.state!=null&&(e=t.state),t.district!=null&&(e=t.district),i.forEach(l=>{e=e.replaceAll(l,"_")}),e},clicked(t){console.log(t);const{state:e,district:i,country:l}=t.properties;let n={};l!=null&&(n.country=l,this.$emit("polygon-clicked",n),this.showMap=!1,this.tooltip.html("").style("visibility","hidden"));let r=[];e&&(r.push(e),n.state=e),i&&(n.district=i,n.country="India"),r.length&&(this.$emit("polygon-clicked",n),r=r.join(" "),navigator.clipboard.writeText(r),this.showMap=!1,this.tooltip.html("").style("visibility","hidden"))},drawPolygonBoundary(t){this.polygons.append("g").data([t]).enter().append("path").classed("state-boundary",!0).classed("selected-polygon",e=>this.selected.state&&e.properties.state==this.selected.state||this.selected.region&&e.properties.region==this.selected.region).attr("properties",e=>JSON.stringify(e.properties)).attr("d",this.path).attr("id",this.getPolygonId(t.properties))},drawPolygonLabel(t,e){const i=this.regional_data[this.polygon_mode].find(n=>n[this.polygon_key]==e.properties[this.polygon_key]);let l="";i&&(l=this.format_number(i[this.data_mode])),t.append("g").data([e]).enter().append("text").classed("poly_text",!0).attr("x",n=>this.path.centroid(n)[0]).attr("y",n=>this.path.centroid(n)[1]).classed("small-text",!0).attr("text-anchor","middle").text(l).on("mouseover",()=>{this.tooltip.html(this.hover_text(e.properties)).style("visibility","visible")}).on("mousemove",(n,r)=>{this.tooltip.style("top",n.pageY-10+"px").style("left",n.pageX+10+"px")}).on("mouseout",()=>this.tooltip.html("").style("visibility","hidden")).on("click",(n,r)=>this.clicked(r))},color_polygon(t){let e=this.mapData.find(i=>i.name==t[this.mode_key]);return e?this.colors(e.value):this.colors(0)},handleZoom(t){this.zoomTransform=t.transform;let e=1/t.transform.k*.8;this.svg.selectAll(".poly_text").attr("transform",t.transform).style("font-size",`${e}rem`),this.svg.selectAll("path").attr("transform",t.transform),this.svg.selectAll("circle").attr("transform",t.transform).attr("r",e*5)},hover_text(t){let e=Object.entries(t).filter(([i,l])=>i!="id");return e=e.map(([i,l])=>`<tr><td>${H(i)}</td><td>${H(l)}</td></tr>`),`<table border='1' class='d3-tooltip'>${e.join(`
`)}</table>`},format_number(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}}),vt={class:"text-center"},gt={key:0,class:"main-container"},mt={class:"switcher switcher-sm text-center py-2 bg-dark"},_t=["onClick","textContent"],bt=s("div",{id:"map"},[s("div",{id:"map-container"})],-1);function ft(t,e,i,l,n,r){return c(),u(f,null,[s("div",vt,[s("button",{class:j(["btn",t.showMap?"btn-danger btn-sm":"btn-success btn-lg"]),onClick:e[0]||(e[0]=o=>t.showMap=!t.showMap)},_(t.showMap?"Hide":"Show")+" Map ",3)]),t.showMap?(c(),u("div",gt,[s("div",mt,[(c(!0),u(f,null,k(t.modes,o=>(c(),u("button",{class:j(["btn mx-1",o===t.mode?"btn-success":"btn-outline-success bg-light"]),key:o,onClick:y=>t.mode=o,textContent:_(o)},null,10,_t))),128))]),bt])):O("",!0)],64)}const yt=B(ht,[["render",ft]]);const xt={name:"AutoComplete",props:{suggestions:{type:Array,required:!0},value:{type:String,required:!0}},emits:["selected"],data(){return{searchText:"",showSuggestions:!1,filteredSuggestions:[],typingTimer:null,typingTimeout:300}},watch:{value(t,e){this.searchText=t,e.length==0&&this.handleInput()}},methods:{handleInput(){clearTimeout(this.typingTimer),this.searchText.length>=2?this.typingTimeout=setTimeout(()=>{this.filteredSuggestions=this.suggestions.filter(t=>t.toLowerCase().includes(this.searchText.toLowerCase())),this.showSuggestions=!0},this.typingTimeout):(this.filteredSuggestions=[],this.showSuggestions=!1)},selectSuggestion(t){this.searchText=t,this.showSuggestions=!1,this.$emit("selected",t)}}},wt={key:0},kt=["onClick"];function Ct(t,e,i,l,n,r){return c(),u(f,null,[E(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>n.searchText=o),placeholder:"Enter Taxon",class:"form-control",onInput:e[1]||(e[1]=(...o)=>r.handleInput&&r.handleInput(...o)),onKeydown:e[2]||(e[2]=ot((...o)=>r.selectSuggestion&&r.selectSuggestion(...o),["enter"]))},null,544),[[J,n.searchText]]),n.showSuggestions?(c(),u("ul",wt,[(c(!0),u(f,null,k(n.filteredSuggestions,(o,y)=>(c(),u("li",{key:y,onClick:$=>r.selectSuggestion(o)},_(o),9,kt))),128))])):O("",!0)],64)}const $t=B(xt,[["render",Ct],["__scopeId","data-v-e12b96f2"]]);const St=t=>(lt("data-v-fe3451e9"),t=t(),it(),t),Mt={key:0,class:"modal fade show","aria-modal":"true",role:"dialog"},Tt={class:"modal-dialog modal-lg observation-modal"},jt={class:"modal-content"},zt={class:"modal-header"},Nt={class:"modal-title",id:"exampleModalLiveLabel"},At={class:"modal-body"},Dt={class:"d-flex"},It={class:"left"},Pt={class:"form-container"},Ot=["onUpdate:modelValue"],Et={for:"exampleInputEmail1",class:"form-label"},Vt={class:"taxa-lookup-container p-2 row mx-0",style:{"background-color":"#aaa"}},Bt={class:"col"},Lt={class:"form-check form-switch"},qt=St(()=>s("label",{class:"form-check-label",for:"flexSwitchCheckChecked"},"validated",-1)),Ut={class:"right"},Ht={key:1,class:"modal-backdrop fade show"},Jt={name:"ModalEditObservation",props:{show:{type:Boolean,default:!1},data:{type:Object,required:!0}},mounted(){},computed:{show_map(){return this.data.latitude&&this.data.longitude&&(this.data.state==null||this.data.district==null)}},watch:{show(t){this.current_district_coordinator_id=0;let e=document.querySelector("body");t==!0?e.classList.add("modal-open"):e.classList.remove("modal-open")}},methods:{}},Kt=Object.assign(Jt,{props:{show:{type:Boolean,default:!1},data:{type:Object,required:!0}},emits:["close"],setup(t,{emit:e}){const i=t,l=F(),n=C(()=>{const{latitude:d,longitude:m}=o.value;return[{latitude:d,longitude:m}]}),r=()=>{S.value="",e("close")},o=x({}),y=["user","observed_on","place","country","state","district","latitude","longitude","taxa_id","species"];C(()=>i.data.state==null||i.data.district==null),q(()=>i.data,d=>{o.value=JSON.parse(JSON.stringify(d))});const $=d=>{const m={present:"border border-success",absent:"border border-danger"};if(d==="place"||d==="species")return"border border-secondary";const g=o.value[d];return d==="observed_on"?T(g)?m.present:m.absent:g&&typeof g=="string"&&g.length>1||typeof g=="number"&&g>0?m.present:m.absent},T=d=>!d||/^(202[0-3])-09-\d{2}$/.test(d),z=async()=>{await l.dispatch("clean_data/updateData",o.value)&&r()};G(()=>{l.dispatch("data/getTaxa",o.value)});const A=C(()=>l.state.data.taxa.map(d=>`${d.name}-${d.id}`)),S=x(""),D=d=>{const m=d.split("-");console.log(o.value,m),o.value.species===m[0]&&o.value.taxa_id==null&&(o.value.taxa_id=m[1]),S.value=d},b=()=>{S.value=o.value.species},I=d=>{console.log(d,o.value),o.value.country==null&&(o.value.country=d.country),o.value.state==null&&(o.value.state=d.state),o.value.district==null&&(o.value.district=d.district)};return(d,m)=>(c(),u(f,null,[t.show?(c(),u("div",Mt,[s("div",Tt,[s("div",jt,[s("div",zt,[s("h3",Nt,"Observation Details ["+_(t.data.portal)+" # "+_(t.data.id)+"]",1),s("button",{type:"button",class:"btn-close",onClick:r})]),s("div",At,[s("div",Dt,[s("div",It,[s("div",Pt,[(c(),u(f,null,k(y,g=>s("div",{class:"form-floating",key:g},[E(s("input",{class:j(["form-control",$(g)]),"onUpdate:modelValue":L=>o.value[g]=L},null,10,Ot),[[J,o.value[g]]]),s("label",Et,_(at(H)(g)),1)])),64))]),s("div",Vt,[s("div",Bt,[U($t,{suggestions:A.value,value:S.value,onSelected:D},null,8,["suggestions","value"])]),s("div",{class:"col-2"},[s("button",{class:"btn btn-success px-2 ms-3",onClick:b},"ðŸ“‹")])]),s("div",Lt,[E(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":m[0]||(m[0]=g=>o.value.validated=g)},null,512),[[nt,o.value.validated]]),qt])]),s("div",Ut,[U(yt,{data:n.value,modes:["countries","states","districts"],onPolygonClicked:I},null,8,["data"])])])]),s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-secondary",onClick:r},"Close"),s("button",{type:"button",class:"btn btn-success",onClick:z},"Save changes")])])])])):O("",!0),t.show?(c(),u("div",Ht)):O("",!0)],64))}}),Wt=B(Kt,[["__scopeId","data-v-fe3451e9"]]);const Yt={class:"btn-rows bg-secondary"},Ft={class:"btn-group w-100 p-1"},Gt=["textContent","onClick"],Rt={class:"btn-group w-100 p-1"},Xt=["textContent","onClick"],Zt={class:"page-info"},Qt=["value","textContent"],te=["max"],ee={class:"page-btns"},se={key:0,class:"table-container border border-danger"},oe={class:"table table-sm table-hover"},ae={class:"bg-dark text-light"},ne=["textContent","onClick"],le=["onClick"],ie=["textContent"],re={__name:"CleanData",setup(t){const e=F(),i=["counts","inat","ibp","ifb"],l=x(null),n=["all","validated","unvalidated"],r=x("all"),o=x("id"),y=x("asc"),$=x(1e3),T=x(1),z=x(1),A=x(!1),S=x({});G(()=>{e.dispatch("data/getMaps")});const D=C(()=>l.value?{portal:l.value,per_page:$.value,page_no:T.value}:{});q(D,(p,h)=>{p!==h&&e.dispatch("clean_data/getData",D.value)}),q(z,(p,h)=>{p!==h&&(T.value=z.value)});const b=C(()=>e.getters["clean_data/data_with_classes"]),I=C(()=>e.state.clean_data.total_records),d=C(()=>{let p=[];if(b&&b.value&&b.value[0])switch(r.value){case"all":p=b.value;break;case"validated":p=b.value.filter(h=>h.validated);break;case"unvalidated":p=b.value.filter(h=>!h.validated);break}return p}),m=C(()=>b&&b.value&&b.value[0]?d.value.sort((p,h)=>{const a=M=>M===null?typeof M=="number"?0:typeof M=="boolean"?!1:"":M,v=a(p[o.value]),w=a(h[o.value]),P=M=>!isNaN(M),V=M=>typeof M=="boolean";return P(v)&&P(w)||V(v)&&V(w)?y.value==="asc"?v-w:w-v:y.value==="asc"?v.localeCompare(w):w.localeCompare(v)}):[]),g=C(()=>b&&b.value&&b.value[0]?["id","user","observed_on","place","country","state","district","latitude","longitude","taxa_id","species","validated"]:[]),L=p=>{o.value===p?y.value=y.value==="asc"?"desc":"asc":(o.value=p,y.value="asc"),console.log(p,o.value,y.value)},R=p=>{S.value={...p,portal:l.value},A.value=!0},X=()=>{S.value={},A.value=!1,e.dispatch("clean_data/getData",D.value)},Z=p=>p.classes.all?"table-success":"table-danger",Q=(p,h)=>{const v={observed_on:"classes.date",user:"classes.user",country:"classes.location.country",state:"classes.location.state",district:"classes.location.district",latitude:"classes.location.latitude",longitude:"classes.location.longitude",taxa_id:"classes.taxon.taxa_id",species:"classes.taxon.species",validated:"validated"}[h];return v?v.split(".").reduce((P,V)=>P&&P[V],p)?"table-success":"table-danger":"table-warning"};return(p,h)=>(c(),u(f,null,[s("div",Yt,[s("div",Ft,[(c(),u(f,null,k(i,a=>s("button",{class:j(["btn btn-sm mx-2 rounded",{"btn-success":a===l.value,"btn-outline-light":a!==l.value}]),key:a,textContent:_(a),onClick:v=>l.value=l.value==a?null:a},null,10,Gt)),64))]),s("div",Rt,[(c(),u(f,null,k(n,a=>s("button",{class:j(["btn btn-sm mx-2 rounded",{"btn-success":a===r.value,"btn-outline-light":a!==r.value}]),key:a,textContent:_(a),onClick:v=>r.value=r.value==a?null:a},null,10,Xt)),64))]),s("div",Zt,[s("div",null,[W(" Per Page: "),E(s("select",{"onUpdate:modelValue":h[0]||(h[0]=a=>$.value=a)},[(c(),u(f,null,k([100,500,1e3,5e3,1e4],a=>s("option",{key:a,value:a,textContent:_(a)},null,8,Qt)),64))],512),[[rt,$.value]])]),s("div",null,[W(" Page No: "),E(s("input",{type:"number","onUpdate:modelValue":h[1]||(h[1]=a=>z.value=a),min:"1",max:Math.ceil(I.value/$.value)},null,8,te),[[J,z.value]])]),s("div",ee,[s("button",{class:"btn btn-sm btn-info",onClick:h[2]||(h[2]=a=>T.value--)}," < "),s("span",null,"Page "+_(T.value)+" of "+_(Math.ceil(I.value/$.value)),1),s("button",{class:"btn btn-sm btn-info",onClick:h[3]||(h[3]=a=>T.value++)}," > ")]),s("div",null," Displaying: "+_(m.value.length)+" of "+_(I.value),1)])]),l.value?(c(),u("div",se,[s("table",oe,[s("thead",ae,[s("tr",null,[(c(!0),u(f,null,k(g.value,a=>(c(),u("th",{key:a,textContent:_(a),onClick:v=>L(a)},null,8,ne))),128))])]),s("tbody",null,[(c(!0),u(f,null,k(m.value,a=>(c(),u("tr",{key:a.id,onClick:v=>R(a),class:j(Z(a))},[(c(!0),u(f,null,k(g.value,v=>(c(),u("td",{key:v,textContent:_(a[v]),class:j(Q(a,v))},null,10,ie))),128))],10,le))),128))])])])):O("",!0),U(Wt,{show:A.value,data:S.value,onClose:X},null,8,["show","data"])],64))}},de=B(re,[["__scopeId","data-v-5beb1705"]]),K=dt({});K.component("clean-data",de);K.use(ct);K.mount("#app");
